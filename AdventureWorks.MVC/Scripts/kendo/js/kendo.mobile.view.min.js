/*
* Kendo UI Beta v2012.3.1024 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

;(function(e,t){function m(e,t){e[0]&&t[0]&&e[0]!=t[0]&&e.kendoAnimateTo(t,{effects:"fade"})}function g(t){t.each(function(){n.initWidget(e(this),{},i.roles)})}function C(e){var t=e.split("?")[1]||"",n={},r=t.split(/&|=/),i=r.length,s=0;for(;s<i;s+=2)n[r[s]]=r[s+1];return n}var n=window.kendo,r=n.mobile,i=r.ui,s=n.attr,o=n.Class,u=i.Widget,a="init",f="show",l="beforeShow",c="hide",h="z-index",p=n.attrValue,d=n.roleSelector,v=u.extend({init:function(t,n){var r=this;u.fn.init.call(r,t,n),t=r.element,r.params={},r.lastParams={},e.extend(r,n),r._layout(),r._scroller(),r._model()},events:[a,l,f,c],options:{name:"View",title:"",defaultTransition:"",stretch:!1,zoom:!1,model:null},destroy:function(){u.fn.destroy.call(this),this.scroller&&this.scroller.destroy(),n.destroy(this.element)},showStart:function(){var e=this;e.element.css("display",""),e.inited||(e.inited=!0,e.trigger(a,{view:e})),e.layout&&e.layout.attach(e),e._eachWidget(function(t){t.viewShow(e)}),e.trigger(f,{view:e})},hideStart:function(){var e=this;e.layout&&e.layout.detach(e)},hideComplete:function(){var e=this;e.element.hide(),e.trigger(c,{view:e})},updateParams:function(e){var t=this;if(t.trigger(l,{view:t}))return;t.lastParams=t.params,t.params=e,t.trigger(f,{view:t})},switchWith:function(e,t,n,r){var i=this;if(i.trigger(l,{view:i}))return;i.lastParams=i.params,i.params=n,e?(e.hideStart(),i.showStart(),new y({current:e,next:i,transition:t,defaultTransition:e.options.defaultTransition,complete:r})):(i.showStart(),r())},parallaxContents:function(e){var t=this,n=t.content;return e.header[0]||(n=n.add(t.header)),e.footer[0]||(n=n.add(t.footer)),n},_scroller:function(){var e=this;e.options.stretch?e.content.addClass("km-stretched-view"):(e.content.kendoMobileScroller({zoom:e.options.zoom}),e.scroller=e.content.data("kendoMobileScroller"),e.scrollerContent=e.scroller.scrollElement)},_model:function(){var e=this,t=e.element,s=e.options.model;typeof s=="string"&&(s=n.getter(s)(window)),e.model=s,t.find(d("popover")).each(function(){n.initWidget(this,{},i.roles)}),s?n.bind(t.children(),s,i,n.ui,n.dataviz.ui):r.init(t.children())},_layout:function(){var e=this,t=d("content"),n=e.element;n.data("kendoView",e).addClass("km-view"),e.transition=p(n,"transition"),e.header=n.children(d("header")).addClass("km-header"),e.footer=n.children(d("footer")).addClass("km-footer"),n.children(t)[0]||n.wrapInner("<div "+s("role")+'="content"></div>'),e.content=n.children(d("content")).addClass("km-content"),e.element.prepend(e.header).append(e.footer),e.id=p(n,"url")||"#"+n.attr("id"),e.layout&&e.layout.setup(e)},_eachWidget:function(t){var r;this.element.find("[data-"+n.ns+"role]").each(function(){r=n.widgetInstance(e(this),i),r&&t(r)})}}),y=o.extend({init:function(t){e.extend(this,t);var n=this,r=n.current,i=n.next,s=r.element,o=i.element,u=i,a=r,f=n._transition();f.reverse&&!f.parallax&&(u=r,a=i),u.element.css(h,1),a.element.css(h,0),f.parallax&&(m(r.footer,i.footer),m(r.header,i.header),s=r.parallaxContents(i),o=i.parallaxContents(r)),s.kendoAnimateTo(o,f),n.back()||(r.nextView=i,r.backTransition=f.transition)},_transition:function(){var e=this,t=e.current,n=e.next,r=e.back(),i=function(){t.hideComplete(),e.complete()},s=r?n.backTransition:n.transition,o=e.transition||s||e.defaultTransition,u=o.split(" "),a=u[0],f=/^slide/.test(a),l=u[1]==="reverse";return e.back()&&!e.transition&&(l=!l),{effects:a,reverse:l,parallax:f,complete:i,transition:o}},back:function(){var e=this.next,t=this.current;return e.nextView===t&&JSON.stringify(e.params)===JSON.stringify(e.lastParams)}}),b=u.extend({init:function(e,t){var r=this;u.fn.init.call(r,e,t),e=r.element,r.element=e.detach(),r.header=e.children(d("header")).addClass("km-header"),r.footer=e.children(d("footer")).addClass("km-footer"),r.elements=r.header.add(r.footer),n.mobile.init(r.element.children()),r.trigger(a,{layout:r})},options:{name:"Layout"},events:[a,f,c],setup:function(e){e.header[0]||(e.header=this.header),e.footer[0]||(e.footer=this.footer)},detach:function(e){var t=this;e.header===t.header&&e.element.prepend(t.header.detach().clone(!0)),e.footer===t.footer&&e.element.append(t.footer.detach().clone(!0)),t.trigger(c,{layout:t,view:e})},attach:function(e){var t=this;e.header===t.header&&(t.header.detach(),e.element.children(d("header")).remove(),e.element.prepend(t.header)),e.footer===t.footer&&(t.footer.detach(),e.element.children(d("footer")).remove(),e.element.append(t.footer)),t.trigger(f,{layout:t,view:e})}}),w=n.Observable,E=/<body[^>]*>(([\u000a\u000d\u2028\u2029]|.)*)<\/body>/i,S="loadStart",x="loadComplete",T="showStart",N="viewShow",k=w.extend({init:function(t){var n=this,r,i;w.fn.init.call(n),e.extend(n,t),n.sandbox=e("<div />"),i=n.container,r=n._hideViews(i),n.rootView=r.first();if(!n.rootView[0])throw new Error('Your kendo mobile application element does not contain any direct child elements with data-role="view" attribute set. Make sure that you instantiate the mobile mobile application using the correct container.');n._view=null,n.layouts={},n._setupLayouts(i),g(i.children(d("modalview"))),n.loader&&(n.bind(T,function(){n.loader.transition()}),n.bind(S,function(){n.loader.show()}),n.bind(x,function(){n.loader.hide()}),n.bind(N,function(){n.loader.transitionDone()}))},view:function(){return this._view},showView:function(e,t){var n=this,r=n.container,i=C(e),o=e.charAt(0)==="#",u=!o&&!e.match(/^\w/),a,f,l=e.split("?")[0];if(e===n.url)return;n.url=e,n.trigger(T),e?(f=r.children("["+s("url")+"='"+e+"']"),!f[0]&&!u&&(f=r.children(o?l:"#"+l))):f=n.rootView,a=f.data("kendoView"),f[0]?(a||(a=n._createView(f)),n._show(a,t,i)):n._loadView(e,function(e){n._show(e,t,i)})},_createView:function(e){var t=this,r,s=p(e,"layout");return typeof s=="undefined"&&(s=t.layout),s&&(s=t.layouts[s]),r={defaultTransition:t.transition,loader:t.loader,container:t.container,layout:s},n.initWidget(e,r,i.roles)},_loadView:function(t,n){var r=this;r._xhr&&r._xhr.abort(),r.trigger(S),r._xhr=e.get(t,function(e){r.trigger(x),n(r._createRemoteView(t,e))},"html").fail(function(e){r.trigger(x),e.status===0&&e.responseText&&n(r._createRemoteView(t,e.responseText))})},_createRemoteView:function(e,t){var n=this,r=n.sandbox,i=n.container,o,u,a;return E.test(t)&&(t=RegExp.$1),r[0].innerHTML=t,i.append(r.children("script, style")),o=n._hideViews(r),a=o.first(),a.hide().attr(s("url"),e),n._setupLayouts(r),u=r.children(d("modalview")),i.append(r.children(d("layout modalview")).add(o)),g(u),n._createView(a)},_show:function(e,t,n){var r=this;r._view!==e?e.switchWith(r._view,t,n,function(){r._view=e,r.trigger(N,{view:e})}):(r._view.updateParams(n),r.trigger(N,{view:e}))},_hideViews:function(e){return e.children(d("view splitview")).hide()},_setupLayouts:function(s){var o=this;s.children(d("layout")).each(function(){var s=e(this),u=p(s,"platform");if(u===t||u===r.application.os)o.layouts[s.data("id")]=n.initWidget(s,{},i.roles)})}});n.mobile.ViewEngine=k,i.plugin(v),i.plugin(b)})(jQuery);