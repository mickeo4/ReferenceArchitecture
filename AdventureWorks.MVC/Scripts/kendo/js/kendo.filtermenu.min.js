/*
* Kendo UI Beta v2012.3.1024 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

;(function(e,t){function d(t,n){t.filters&&(t.filters=e.grep(t.filters,function(e){return d(e,n),e.filters?e.filters.length:e.field!=n}))}function v(e){var t,n,r,i,s,o;if(e&&e.length){o=[];for(t=0,n=e.length;t<n;t++)r=e[t],s=r.text||r.value||r,i=r.value==null?r.text||r:r.value,o[t]={text:s,value:i}}return o}var n=window.kendo,r=n.ui,i="kendoNumericTextBox",s="kendoDatePicker",o=e.proxy,u="kendoPopup",a=".kendoFilterMenu",f="Is equal to",l="Is not equal to",c=r.Widget,h='<div><div class="k-filter-help-text">#=messages.info#</div><label><input type="radio" data-#=ns#bind="checked: filters[0].value" value="true" name="filters[0].value"/>#=messages.isTrue#</label><label><input type="radio" data-#=ns#bind="checked: filters[0].value" value="false" name="filters[0].value"/>#=messages.isFalse#</label><button type="submit" class="k-button">#=messages.filter#</button><button type="reset" class="k-button">#=messages.clear#</button></div>',p='<div><div class="k-filter-help-text">#=messages.info#</div><select data-#=ns#bind="value: filters[0].operator" data-#=ns#role="dropdownlist">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select>#if(values){#<select data-#=ns#bind="value:filters[0].value" data-#=ns#text-field="text" data-#=ns#value-field="value" data-#=ns#source=\'#=kendo.stringify(values).replace(/\'/g,"&\\#39;")#\' data-#=ns#role="dropdownlist" data-#=ns#option-label="#=messages.selectValue#"></select>#}else{#<input data-#=ns#bind="value:filters[0].value" class="k-textbox" type="text" data-#=ns#type="#=type#"/>#}##if(extra){#<select class="k-filter-and" data-#=ns#bind="value: logic" data-#=ns#role="dropdownlist"><option value="and">#=messages.and#</option><option value="or">#=messages.or#</option></select><select data-#=ns#bind="value: filters[1].operator" data-#=ns#role="dropdownlist">#for(var op in operators){#<option value="#=op#">#=operators[op]#</option>#}#</select>#if(values){#<select data-#=ns#bind="value:filters[1].value" data-#=ns#text-field="text" data-#=ns#value-field="value" data-#=ns#source=\'#=kendo.stringify(values).replace(/\'/g,"&\\#39;")#\' data-#=ns#role="dropdownlist" data-#=ns#option-label="#=messages.selectValue#"></select>#}else{#<input data-#=ns#bind="value: filters[1].value" class="k-textbox" type="text" data-#=ns#type="#=type#"/>#}##}#<button type="submit" class="k-button">#=messages.filter#</button><button type="reset" class="k-button">#=messages.clear#</button></div>',m=c.extend({init:function(t,r){var f=this,l="string",d,m,g;c.fn.init.call(f,t,r),g=r.operators||{},t=f.element,r=f.options,r.appendToElement?f.link=e():(d=t.addClass("k-filterable").find(".k-grid-filter"),d[0]||(d=t.prepend('<a class="k-grid-filter" href="#"><span class="k-icon k-filter"/></a>').find(".k-grid-filter")),d.attr("tabindex",-1).on("click"+a,o(f._click,f))),f._refreshHandler=o(f.refresh,f),f.dataSource=r.dataSource.bind("change",f._refreshHandler),f.field=r.field||t.attr(n.attr("field")),f.model=f.dataSource.reader.model,f._parse=function(e){return e+""},f.model&&f.model.fields&&(m=f.model.fields[f.field],m&&(l=m.type||"string",f._parse=o(m.parse,m))),r.values&&(l="enums"),g=g[l]||r.operators[l],f.form=e('<form class="k-filter-menu"/>').html(n.template(l==="boolean"?h:p)({field:f.field,ns:n.ns,messages:r.messages,extra:r.extra,operators:g,type:l,values:v(r.values)})).on("keydown"+a,o(f._keydown,f)).on("submit"+a,o(f._submit,f)).on("reset"+a,o(f._reset,f)),r.appendToElement?(t.append(f.form),f.popup=f.element.closest(".k-popup").data(u)):(f.popup=f.form[u]({anchor:d,open:o(f._open,f),activate:o(f._activate,f),close:f.options.closeCallback}).data(u),f.link=d),f.form.find("["+n.attr("type")+"=number]").removeClass("k-textbox")[i]().end().find("["+n.attr("type")+"=date]").removeClass("k-textbox")[s](),f.refresh()},refresh:function(){var e=this,t=e.dataSource.filter()||{filters:[],logic:"and"};e.filterModel=n.observable({logic:"and",filters:[{field:e.field,operator:"eq",value:""},{field:e.field,operator:"eq",value:""}]}),n.bind(e.form.children().first(),e.filterModel),e._bind(t)?e.link.addClass("k-state-active"):e.link.removeClass("k-state-active")},destroy:function(){var e=this;c.fn.destroy.call(e),n.unbind(e.form),n.destroy(e.form),e.form.unbind(a),e.popup.destroy(),e.link.unbind(a),e.dataSource.unbind("change",e._refreshHandler)},_bind:function(e){var t=this,n=e.filters,r,i,s=!1,o=0,u=t.filterModel,a,f;for(r=0,i=n.length;r<i;r++)f=n[r],f.field==t.field?(u.set("logic",e.logic),a=u.filters[o],a||(u.filters.push({field:t.field}),a=u.filters[o]),a.set("value",t._parse(f.value)),a.set("operator",f.operator),o++,s=!0):f.filters&&(s=s||t._bind(f));return s},_merge:function(t){var n=this,r=t.logic||"and",i=t.filters,s,o=n.dataSource.filter()||{filters:[],logic:"and"},u,a;d(o,n.field),i=e.grep(i,function(e){return e.value!==""});for(u=0,a=i.length;u<a;u++)s=i[u],s.value=n._parse(s.value);return i.length&&(o.filters.length?(t.filters=i,o.logic!=="and"&&(o.filters=[{logic:o.logic,filters:o.filters}],o.logic="and"),i.length>1?o.filters.push(t):o.filters.push(i[0])):(o.filters=i,o.logic=r)),o},filter:function(e){e=this._merge(e),e.filters.length&&this.dataSource.filter(e)},clear:function(){var t=this,n=t.dataSource.filter()||{filters:[]};n.filters=e.grep(n.filters,function(n){return n.filters?(n.filters=e.grep(n.filters,function(e){return e.field!=t.field}),n.filters.length):n.field!=t.field}),n.filters.length||(n=null),t.dataSource.filter(n)},_submit:function(e){var t=this;e.preventDefault(),t.filter(t.filterModel.toJSON()),t.popup.close()},_reset:function(e){this.clear(),this.popup.close()},_click:function(e){e.preventDefault(),e.stopPropagation(),this.popup.toggle()},_open:function(){var t;e(".k-filter-menu").not(this.form).each(function(){t=e(this).data(u),t&&t.close()})},_activate:function(){this.form.find(":focusable:first").focus()},_keydown:function(e){e.keyCode==n.keys.ESC&&this.popup.close()},options:{name:"FilterMenu",extra:!0,appendToElement:!1,type:"string",operators:{string:{eq:f,neq:l,startswith:"Starts with",contains:"Contains",doesnotcontain:"Does not contain",endswith:"Ends with"},number:{eq:f,neq:l,gte:"Is greater than or equal to",gt:"Is greater than",lte:"Is less than or equal to",lt:"Is less than"},date:{eq:f,neq:l,gte:"Is after or equal to",gt:"Is after",lte:"Is before or equal to",lt:"Is before"},enums:{eq:f,neq:l}},messages:{info:"Show items with value that:",isTrue:"is true",isFalse:"is false",filter:"Filter",clear:"Clear",and:"And",or:"Or",selectValue:"-Select value-"}}});r.plugin(m)})(jQuery);