/*
* Kendo UI Beta v2012.3.1024 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

;(function(e,t){function et(e){return(new Array(e+1)).join('<td class="k-group-cell">&nbsp;</td>')}function tt(e){var t,n=" ";if(e){if(typeof e===V)return e;for(t in e)n+=t+'="'+e[t]+'"'}return n}function rt(t){var n=0;return e("> .k-grouping-header, > .k-grid-toolbar",t).each(function(){n+=this.offsetHeight}),n}function it(t,n){e("th, th .k-grid-filter, th .k-link",t).add(document.body).css("cursor",n)}function st(e){var t,n,r={},i={};if(!g(e)){p(e)||(e=[e]);for(t=0,n=e.length;t<n;t++)r[e[t].aggregate]=0,i[e[t].field]=r}return i}function ot(e,t,n){var r=e.eq(t),i=e.eq(n);r[t>n?"insertBefore":"insertAfter"](i)}function ut(e,t,n){var r,i,s,o;n=p(n)?n:[n];for(r=0,i=n.length;r<i;r++)s=n[r],f(s)&&s.click&&(o=s.name||s.text,t.on(U,"a.k-grid-"+(o||"").replace(/\s/g,""),{commandName:o},v(s.click,e)))}function at(e){return h(e,function(e){return!e.hidden})}function ft(e){e=e||{};var t=e.style;return t?(t=t.replace(/((.*)?display)(.*)?:([^;]*)/i,"$1:none"),t===e.style&&(t=t.replace(/(.*)?/i,"display:none;$1"))):t="display:none",l({},e,{style:t})}function lt(e){e=e||{};var t=e.style;return t&&(e.style=t.replace(/((.*)?)(display\s*:\s*none)\s*;?/i,"$1")),e}function ct(t,r,i,s){var o=t.find(">colgroup"),u,a=c(r,function(e){return u=e.width,u&&parseInt(u,10)!==0?n.format('<col style="width:{0}"/>',typeof u===V?u:u+"px"):"<col />"});(i||o.find(".k-hierarchy-col").length)&&a.splice(0,0,'<col class="k-hierarchy-col" />'),o.length&&o.remove(),o=e("<colgroup/>").append(e((new Array(s+1)).join('<col class="k-group-col">')+a.join(""))),t.prepend(o)}function pt(e,t){var n,r,i;if(typeof e===V&&e===t)return e;if(f(e)&&e.name===t)return e;if(p(e))for(n=0,r=e.length;n<r;n++){i=e[n];if(typeof i===V&&i===t||i.name===t)return i}return null}function dt(t){var n=e(t.currentTarget),r=n.closest("table")[0];if(r!==this.table[0]&&r!==this.thead.parent()[0])return;this.current(n),(n.is("th")||!e(t.target).is(":button,a,:input,a>.k-icon,textarea,span.k-icon,.k-input"))&&setTimeout(function(){r.focus()}),n.is("th")&&t.preventDefault()}var n=window.kendo,r=n.ui,i=n.data.DataSource,s=r.Groupable,o=n.support.tbodyInnerHtml,u=r.Widget,a=n.keys,f=e.isPlainObject,l=e.extend,c=e.map,h=e.grep,p=e.isArray,d=e.inArray,v=e.proxy,m=e.isFunction,g=e.isEmptyObject,y=Math,b="requestStart",w="error",E=":not(.k-group-cell):not(.k-hierarchy-cell):visible",S="tbody>tr:not(.k-grouping-row):not(.k-detail-row):not(.k-group-footer) > td:not(.k-group-cell):not(.k-hierarchy-cell)",x="tr:not(.k-footer-template):visible",T=":not(.k-group-cell):not(.k-hierarchy-cell):visible",N=x+":first>"+T+":first",C=".kendoGrid",k="edit",L="save",A="remove",O="detailInit",M="change",_="columnHide",D="columnShow",P="saveChanges",H="dataBound",B="detailExpand",j="detailCollapse",F="k-state-focused",I="k-state-selected",q="columnResize",R="columnReorder",U="click",z="height",W="tabIndex",X="function",V="string",$="Are you sure you want to delete this record?",J=/(\}|\#)/ig,K=3,Q=/#/ig,G='<a class="k-button k-button-icontext #=className#" #=attr# href="\\#"><span class="#=iconClass# #=imageClass#"></span>#=text#</a>',Y=!1,Z=u.extend({init:function(e,t){var n=this;u.fn.init.call(n,e,t),n._refreshHandler=v(n.refresh,n),n.setDataSource(t.dataSource),n.wrap()},setDataSource:function(e){var t=this;t.dataSource&&t.dataSource.unbind(M,t._refreshHandler),t.dataSource=e,t.dataSource.bind(M,t._refreshHandler)},options:{name:"VirtualScrollable",itemHeight:e.noop},destroy:function(){var e=this;u.fn.destroy.call(e),e.dataSource.unbind(M,e._refreshHandler),e.wrapper.add(e.verticalScrollbar).off(C),e.drag&&e.drag.destroy()},wrap:function(){var t=this,r=n.support.scrollbar()+1,i=t.element,s;i.css({width:"auto",overflow:"hidden"}).css(Y?"padding-left":"padding-right",r),t.content=i.children().first(),s=t.wrapper=t.content.wrap('<div class="k-virtual-scrollable-wrap"/>').parent().bind("DOMMouseScroll"+C+" mousewheel"+C,v(t._wheelScroll,t)),n.support.touch&&(t.drag=new n.UserEvents(t.wrapper,{global:!0,move:function(e){t.verticalScrollbar.scrollTop(t.verticalScrollbar.scrollTop()-e.y.delta),s.scrollLeft(s.scrollLeft()-e.x.delta),e.preventDefault()}})),t.verticalScrollbar=e('<div class="k-scrollbar k-scrollbar-vertical" />').css({width:r}).appendTo(i).bind("scroll"+C,v(t._scroll,t))},_wheelScroll:function(e){var n=this,r=n.verticalScrollbar.scrollTop(),i=e.originalEvent,s=i.wheelDeltaY,o;if(i.wheelDelta){if(s===t||s)o=i.wheelDelta}else i.detail&&i.axis===i.VERTICAL_AXIS&&(o=-i.detail*10);o&&(e.preventDefault(),n.verticalScrollbar.scrollTop(r+ -o))},_scroll:function(e){var t=this,n=e.currentTarget.scrollTop,r=t.dataSource,i=t.itemHeight,s=r.skip()||0,o=t._rangeStart||s,u=t.element.innerHeight(),a=!!(t._scrollbarTop&&t._scrollbarTop>n),f=y.max(y.floor(n/i),0),l=y.max(f+y.floor(u/i),0);t._scrollTop=n-o*i,t._scrollbarTop=n,t._fetch(f,l,a)||(t.wrapper[0].scrollTop=t._scrollTop)},_fetch:function(e,t,n){var r=this,i=r.dataSource,s=r.itemHeight,o=i.take(),u=r._rangeStart||i.skip()||0,a=y.floor(e/o)*o,f=!1,l=.33;return e<u?(f=!0,u=y.max(0,t-o),r._scrollTop=(e-u)*s,r._page(u,o)):t>=u+o&&!n?(f=!0,u=e,r._scrollTop=s,r._page(u,o)):r._fetching||(e<a+o-o*l&&e>o&&i.prefetch(a-o,o),t>a+o*l&&i.prefetch(a+o,o)),f},_page:function(e,t){var r=this,i=r.dataSource;clearTimeout(r._timeout),r._fetching=!0,r._rangeStart=e,i.inRange(e,t)?i.range(e,t):(n.ui.progress(r.wrapper.parent(),!0),r._timeout=setTimeout(function(){i.range(e,t)},100))},refresh:function(){var e=this,t="",r=25e4,i=e.dataSource,s=e._rangeStart,o=n.support.scrollbar(),u=e.wrapper[0],a,f,l;n.ui.progress(e.wrapper.parent(),!1),clearTimeout(e._timeout),l=e.itemHeight=e.options.itemHeight()||0;var c=u.scrollWidth>u.offsetWidth?o:0;a=i.total()*l+c;for(f=0;f<y.floor(a/r);f++)t+='<div style="width:1px;height:'+r+'px"></div>';a%r&&(t+='<div style="width:1px;height:'+a%r+'px"></div>'),e.verticalScrollbar.html(t),u.scrollTop=e._scrollTop,e.drag&&e.drag.cancel(),s&&!e._fetching&&(e._rangeStart=i.skip()),e._fetching=!1}}),nt={create:{text:"Add new record",imageClass:"k-add",className:"k-grid-add",iconClass:"k-icon"},cancel:{text:"Cancel changes",imageClass:"k-cancel",className:"k-grid-cancel-changes",iconClass:"k-icon"},save:{text:"Save changes",imageClass:"k-update",className:"k-grid-save-changes",iconClass:"k-icon"},destroy:{text:"Delete",imageClass:"k-delete",className:"k-grid-delete",iconClass:"k-icon"},edit:{text:"Edit",imageClass:"k-edit",className:"k-grid-edit",iconClass:"k-icon"},update:{text:"Update",imageClass:"k-update",className:"k-grid-update",iconClass:"k-icon"},canceledit:{text:"Cancel",imageClass:"k-cancel",className:"k-grid-cancel",iconClass:"k-icon"}},ht=u.extend({init:function(e,t){var r=this;t=p(t)?{dataSource:t}:t,u.fn.init.call(r,e,t),Y=n.support.isRtl(e),r._element(),r._aria(),r._columns(r.options.columns),r._dataSource(),r._tbody(),r._pageable(),r._thead(),r._groupable(),r._toolbar(),r._setContentHeight(),r._templates(),r._navigatable(),r._selectable(),r._details(),r._editable(),r._attachCustomCommandsEvent(),r.options.autoBind?r.dataSource.fetch():r._footer(),n.notify(r)},events:[M,"dataBinding",H,B,j,O,k,L,A,P,q,R,D,_],setDataSource:function(e){var t=this;t.options.dataSource=e,t._dataSource(),t._pageable(),t.options.groupable&&t._groupable(),t._thead(),t.virtualScrollable&&t.virtualScrollable.setDataSource(t.options.dataSource),t.options.autoBind&&e.fetch()},options:{name:"Grid",columns:[],toolbar:null,autoBind:!0,filterable:!1,scrollable:!0,sortable:!1,selectable:!1,navigatable:!1,pageable:!1,editable:!1,groupable:!1,rowTemplate:"",altRowTemplate:"",dataSource:{},height:null,resizable:!1,reorderable:!1,columnMenu:!1,detailTemplate:null},destroy:function(){var t=this;u.fn.destroy.call(t),t.pager&&t.pager.destroy(),t.groupable&&t.groupable.destroy(),t.virtualScrollable&&t.virtualScrollable.destroy(),t.thead.find("th").each(function(){var t=e(this),n=t.data("kendoFilterMenu"),r=t.data("kendoSortable"),i=t.data("kendoColumnMenu");n&&n.destroy(),r&&r.destroy(),i&&i.destroy()}),t._destroyEditable(),t.dataSource.unbind(M,t._refreshHandler).unbind(b,t._requestStartHandler).unbind(w,t._errorHandler),t.element.add(t.wrapper).add(t.table).add(t.thead).add(t.wrapper.find(">.k-grid-toolbar")),t.content&&t.element.add(t.content).add(t.content.find(">.k-virtual-scrollable-wrap")),t.element.off(C),n.destroy(t.wrapper)},setOptions:function(e){var t=this;u.fn.setOptions.call(this,e),t._templates()},items:function(){return this.tbody.children(":not(.k-grouping-row,.k-detail-row,.k-group-footer)")},_attachCustomCommandsEvent:function(){var e=this,t=e.columns||[],n,r,i;for(r=0,i=t.length;r<i;r++)n=t[r].command,n&&ut(e,e.wrapper,n)},_aria:function(){var e=this.element.attr("id")||"aria";e&&(this._cellId=e+"_active_cell")},_element:function(){var t=this,n=t.element;n.is("table")||(t.options.scrollable?n=t.element.find("> .k-grid-content > table"):n=t.element.children("table"),n.length||(n=e("<table />").appendTo(t.element))),t.table=n.attr("cellspacing",0).attr("role",t._hasDetails()?"treegrid":"grid"),t._wrapper()},_positionColumnResizeHandle:function(t){var n=this,r=n.options.scrollable,i=n.resizeHandle,s;n.thead.on("mousemove"+C,"th:not(.k-group-cell,.k-hierarchy-cell)",function(o){var u=e(this),a=u.offset().left+(Y?0:this.offsetWidth);if(o.clientX>a-K&&o.clientX<a+K){i||(i=n.resizeHandle=e('<div class="k-resize-handle"/>'),t.append(i));if(!Y)s=this.offsetWidth,u.prevAll(":visible").each(function(){s+=this.offsetWidth});else{var f=u.closest(".k-grid-header-wrap"),l=e.browser.msie?f.scrollLeft():0,c=e.browser.webkit?f[0].scrollWidth-f[0].offsetWidth-f.scrollLeft():0,h=e.browser.mozilla?f[0].scrollWidth-f[0].offsetWidth-(f[0].scrollWidth-f[0].offsetWidth-f.scrollLeft()):0;s=u.position().left-c+h-l}i.css({top:r?0:rt(n.wrapper),left:s-K,height:u.outerHeight(),width:K*3}).data("th",u).show()}else i?i.hide():it(n.wrapper,"")})},_resizable:function(){var t=this,n=t.options,r,i,s,o,u;n.resizable&&(r=n.scrollable?t.wrapper.find(".k-grid-header-wrap"):t.wrapper,t._positionColumnResizeHandle(r),r.kendoResizable({handle:".k-resize-handle",hint:function(n){return e('<div class="k-grid-resize-indicator" />').css({height:n.data("th").outerHeight()+t.tbody.attr("clientHeight")})},start:function(r){var a=e(r.currentTarget).data("th"),f=e.inArray(a[0],a.parent().children(":visible")),l=t.tbody.parent(),c=t.footer||e();it(t.wrapper,"col-resize"),n.scrollable?u=t.thead.parent().find("col:eq("+f+")").add(l.children("colgroup").find("col:eq("+f+")")).add(c.find("colgroup").find("col:eq("+f+")")):u=l.children("colgroup").find("col:eq("+f+")"),i=r.x.location,s=a.outerWidth(),o=t.tbody.outerWidth()},resize:function(r){var a=Y?-1:1,f=s+r.x.location*a-i*a,l=t.footer||e();f>10&&(u.css("width",f),n.scrollable&&(t._footerWidth=o+r.x.location*a-i*a,t.tbody.parent().add(t.thead.parent()).add(l.find("table")).css("width",t._footerWidth)))},resizeend:function(n){var r=e(n.currentTarget).data("th"),i=r.outerWidth(),o;it(t.wrapper,""),s!=i&&(o=t.columns[r.parent().find("th:not(.k-group-cell,.k-hierarchy-cell)").index(r)],o.width=i,t.trigger(q,{column:o,oldWidth:s,newWidth:i})),t.resizeHandle.hide()}}))},_draggable:function(){var t=this;t.options.reorderable&&(t._draggableInstance=t.wrapper.kendoDraggable({group:n.guid(),filter:".k-header:not(.k-group-cell,.k-hierarchy-cell)",hint:function(t){return e('<div class="k-header k-drag-clue" />').css({width:t.width(),paddingLeft:t.css("paddingLeft"),paddingRight:t.css("paddingRight"),lineHeight:t.height()+"px",paddingTop:t.css("paddingTop"),paddingBottom:t.css("paddingBottom")}).html(t.attr(n.attr("title"))||t.attr(n.attr("field"))||t.text()).prepend('<span class="k-icon k-drag-status k-denied" />')}}).data("kendoDraggable"))},_reorderable:function(){var e=this;e.options.reorderable&&e.thead.kendoReorderable({draggable:e._draggableInstance,change:function(t){var n=d(e.columns[t.newIndex],e.columns),r=e.columns[t.oldIndex];e.trigger(R,{newIndex:n,oldIndex:d(r,e.columns),column:r}),e.reorderColumn(n,r)}})},reorderColumn:function(e,t){var n=this,r=d(t,n.columns),i=d(t,at(n.columns)),s,o,u,a=n.footer||n.wrapper.find(".k-grid-footer");if(r===e)return;n.columns.splice(r,1),n.columns.splice(e,0,t),n._templates(),ot(n.thead.prev().find("col:not(.k-group-col,.k-hierarchy-col)"),i,e),n.options.scrollable&&ot(n.tbody.prev().find("col:not(.k-group-col,.k-hierarchy-col)"),i,e),ot(n.thead.find(".k-header:not(.k-group-cell,.k-hierarchy-cell)"),r,e),a&&a.length&&(ot(a.find(".k-grid-footer-wrap>table>colgroup>col:not(.k-group-col,.k-hierarchy-col)"),i,e),ot(a.find(".k-footer-template>td:not(.k-group-cell,.k-hierarchy-cell)"),r,e)),s=n.tbody.children(":not(.k-grouping-row,.k-detail-row)");for(o=0,u=s.length;o<u;o+=1)ot(s.eq(o).find(">td:not(.k-group-cell,.k-hierarchy-cell)"),r,e)},cellIndex:function(t){return e(t).parent().children("td:not(.k-group-cell,.k-hierarchy-cell)").index(t)},_modelForContainer:function(t){t=e(t),!t.is("tr")&&this._editMode()!=="popup"&&(t=t.closest("tr"));var r=t.attr(n.attr("uid"));return this.dataSource.getByUid(r)},_editable:function(){var t=this,n=t.options.editable,r=function(){var n=document.activeElement,r=t._editContainer;r&&!e.contains(r[0],n)&&r[0]!==n&&!e(n).closest(".k-animation-container").length&&t.editable.end()&&t.closeCell()};if(n){var i=t._editMode();i==="incell"?n.update!==!1&&t.wrapper.on(U+C,"tr:not(.k-grouping-row) > td",function(n){var r=e(this);if(r.hasClass("k-hierarchy-cell")||r.hasClass("k-detail-cell")||r.hasClass("k-group-cell")||r.hasClass("k-edit-cell")||r.has("a.k-grid-delete").length||r.has("button.k-grid-delete").length||r.closest("tbody")[0]!==t.tbody[0]||e(n.target).is(":input"))return;t.editable?t.editable.end()&&(t.closeCell(),t.editCell(r)):t.editCell(r)}).on("focusin"+C,function(e){clearTimeout(t.timer),t.timer=null}).on("focusout"+C,function(e){t.timer=setTimeout(r,1)}):n.update!==!1&&t.wrapper.on(U+C,"tbody>tr:not(.k-detail-row,.k-grouping-row):visible a.k-grid-edit",function(n){n.preventDefault(),t.editRow(e(this).closest("tr"))}),n.destroy!==!1?t.wrapper.on(U+C,"tbody>tr:not(.k-detail-row,.k-grouping-row):visible .k-grid-delete",function(n){n.preventDefault(),n.stopPropagation(),t.removeRow(e(this).closest("tr"))}):t.wrapper.on(U+C,"tbody>tr:not(.k-detail-row,.k-grouping-row):visible button.k-grid-delete",function(e){t._confirmation()||e.preventDefault()})}},editCell:function(e){var t=this,n=t.columns[t.cellIndex(e)],r=t._modelForContainer(e);r&&(!r.editable||r.editable(n.field))&&!n.command&&n.field&&(t._attachModelChange(r),t._editContainer=e,t.editable=e.addClass("k-edit-cell").kendoEditable({fields:{field:n.field,format:n.format,editor:n.editor,values:n.values},model:r,change:function(n){t.trigger(L,{values:n.values,container:e,model:r})&&n.preventDefault()}}).data("kendoEditable"),e.parent().addClass("k-grid-edit-row"),t.trigger(k,{container:e,model:r}))},_destroyEditable:function(){var e=this,t=function(){e.editable&&(e._detachModelChange(),e.editable.destroy(),e.editable=null,e._editContainer=null)};e.editable&&(e._editMode()==="popup"?e._editContainer.data("kendoWindow").bind("deactivate",t).close():t())},_attachModelChange:function(e){var t=this;t._modelChangeHandler=function(e){t._modelChange({field:e.field,model:this})},e.bind("change",t._modelChangeHandler)},_detachModelChange:function(){var e=this,t=e._editContainer,n=e._modelForContainer(t);n&&n.unbind(M,e._modelChangeHandler)},closeCell:function(){var t=this,r=t._editContainer.removeClass("k-edit-cell"),i=r.closest("tr").attr(n.attr("uid")),s=t.columns[t.cellIndex(r)],o=t.dataSource.getByUid(i);r.parent().removeClass("k-grid-edit-row"),t._destroyEditable(),t._displayCell(r,s,o),r.hasClass("k-dirty-cell")&&e('<span class="k-dirty"/>').prependTo(r)},_displayCell:function(e,t,r){var i=this,s={storage:{},count:0},o=l({},n.Template,i.options.templateSettings),u=n.template(i._cellTmpl(t,s),o);s.count>0&&(u=v(u,s.storage)),e.empty().html(u(r))},removeRow:function(t){var n=this,r,i;if(!n._confirmation())return;t=e(t).hide(),r=n._modelForContainer(t),r&&!n.trigger(A,{row:t,model:r})&&(n.dataSource.remove(r),i=n._editMode(),(i==="inline"||i==="popup")&&n.dataSource.sync())},_editMode:function(){var e="incell",t=this.options.editable;return t!==!0&&(typeof t=="string"?e=t:e=t.mode||e),e},editRow:function(t){var n=this,r=n._modelForContainer(t),i=n._editMode(),s=n.options.navigatable,o;n.cancelRow(),r&&(n._attachModelChange(r),i==="popup"?n._createPopupEditor(r):i==="inline"?n._createInlineEditor(t,r):i==="incell"&&e(t).children(E).each(function(){var t=e(this),i=n.columns[t.index()];r=n._modelForContainer(t);if(r&&(!r.editable||r.editable(i.field))&&i.field)return n.editCell(t),!1}),o=n._editContainer,o.on(U+C,"a.k-grid-cancel",function(t){t.preventDefault(),t.stopPropagation();var r=n.items().index(e(n.current()).parent());n.cancelRow(),s&&(n.current(n.items().eq(r).children().filter(T).first()),n.table.focus())}),o.on(U+C,"a.k-grid-update",function(e){e.preventDefault(),e.stopPropagation(),n.saveRow()}))},_createPopupEditor:function(t){var r=this,i="<div "+n.attr("uid")+'="'+t.uid+'"><div class="k-edit-form-container">',s,o,u=[],a,c,h,p,d,m,g=r.options.editable,y=g.template,b=f(g)?g.window:{},w=l({},n.Template,r.options.templateSettings);if(y){typeof y===V&&(y=window.unescape(y)),i+=n.template(y,w)(t);for(a=0,c=r.columns.length;a<c;a++)s=r.columns[a],s.command&&(o=pt(s.command,"edit"))}else for(a=0,c=r.columns.length;a<c;a++){s=r.columns[a];if(!s.command){i+='<div class="k-edit-label"><label for="'+s.field+'">'+(s.title||s.field||"")+"</label></div>";if((!t.editable||t.editable(s.field))&&s.field)u.push({field:s.field,format:s.format,editor:s.editor,values:s.values}),i+="<div "+n.attr("container-for")+'="'+s.field+'" class="k-edit-field"></div>';else{var E={storage:{},count:0};h=n.template(r._cellTmpl(s,E),w),E.count>0&&(h=v(h,E.storage)),i+='<div class="k-edit-field">'+h(t)+"</div>"}}else s.command&&(o=pt(s.command,"edit"))}o&&f(o)&&(o.text&&f(o.text)&&(p=o.text.update,d=o.text.cancel),o.attr&&(m=o.attr)),i+=r._createButton({name:"update",text:p,attr:m})+r._createButton({name:"canceledit",text:d,attr:m}),i+="</div></div>";var S=r._editContainer=e(i).appendTo(r.wrapper).eq(0).kendoWindow(l({modal:!0,resizable:!1,draggable:!0,title:"Edit",visible:!1,close:function(e){e.userTriggered&&r.cancelRow()}},b));r.editable=r._editContainer.kendoEditable({fields:u,model:t,clearContainer:!1}).data("kendoEditable"),S.data("kendoWindow").center().open(),r.trigger(k,{container:S,model:t})},_createInlineEditor:function(t,n){var r=this,i,s,o,u=[];t.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){s=e(this),i=r.columns[r.cellIndex(s)];if(!i.command&&i.field&&(!n.editable||n.editable(i.field)))u.push({field:i.field,format:i.format,editor:i.editor,values:i.values}),s.attr("data-container-for",i.field),s.empty();else if(i.command){o=pt(i.command,"edit");if(o){s.empty();var t,a,l;f(o)&&(o.text&&f(o.text)&&(t=o.text.update,a=o.text.cancel),o.attr&&(l=o.attr)),e(r._createButton({name:"update",text:t,attr:l})+r._createButton({name:"canceledit",text:a,attr:l})).appendTo(s)}}}),r._editContainer=t,r.editable=t.addClass("k-grid-edit-row").kendoEditable({fields:u,model:n,clearContainer:!1}).data("kendoEditable"),r.trigger(k,{container:t,model:n})},cancelRow:function(){var e=this,t=e._editContainer,r;t&&(r=e._modelForContainer(t),e.dataSource.cancelChanges(r),e._editMode()!=="popup"?e._displayRow(t):e._displayRow(e.items().filter("["+n.attr("uid")+"="+r.uid+"]")),e._destroyEditable())},saveRow:function(){var e=this,t=e._editContainer,n=e._modelForContainer(t),r=e.editable;t&&r&&r.end()&&!e.trigger(L,{container:t,model:n})&&e.dataSource.sync()},_displayRow:function(t){var n=this,r=n._modelForContainer(t);r&&t.replaceWith(e((t.hasClass("k-alt")?n.altRowTemplate:n.rowTemplate)(r)))},_showMessage:function(e){return window.confirm(e)},_confirmation:function(){var e=this,t=e.options.editable,n=t===!0||typeof t===V?$:t.confirmation;return n!==!1&&n!=null?e._showMessage(n):!0},cancelChanges:function(){this.dataSource.cancelChanges()},saveChanges:function(){var e=this;(e.editable&&e.editable.end()||!e.editable)&&!e.trigger(P)&&e.dataSource.sync()},addRow:function(){var e=this,t,r=e.dataSource,i=e._editMode(),s=e.options.editable.createAt||"",o=r.pageSize(),u=r.view()||[];if(e.editable&&e.editable.end()||!e.editable){i!="incell"&&e.cancelRow(),t=r.indexOf(u[0]),s.toLowerCase()=="bottom"&&(t+=u.length,o&&!r.options.serverPaging&&o<=u.length&&(t-=1)),t<0&&(t=0);var a=r.insert(t,{}),f=a.uid,l=e.table.find("tr["+n.attr("uid")+"="+f+"]"),c=l.children("td:not(.k-group-cell,.k-hierarchy-cell)").first();i!=="inline"&&i!=="popup"||!l.length?c.length&&e.editCell(c):e.editRow(l)}},_toolbar:function(){var t=this,r=t.wrapper,i=t.options.toolbar,s=t.options.editable,o,u;i&&(o=t.wrapper.find(".k-grid-toolbar"),o.length||(i=m(i)?i({}):typeof i===V?i:t._toolbarTmpl(i).replace(Q,"\\#"),u=v(n.template(i),t),o=e('<div class="k-toolbar k-grid-toolbar" />').html(u({})).prependTo(r)),s&&s.create!==!1&&o.on(U+C,".k-grid-add",function(e){e.preventDefault(),t.addRow()}).on(U+C,".k-grid-cancel-changes",function(e){e.preventDefault(),t.cancelChanges()}).on(U+C,".k-grid-save-changes",function(e){e.preventDefault(),t.saveChanges()}))},_toolbarTmpl:function(e){var t=this,n,r,i="";if(p(e))for(n=0,r=e.length;n<r;n++)i+=t._createButton(e[n]);return i},_createButton:function(e){var t=e.template||G,r=typeof e===V?e:e.name||e.text,i={className:"k-grid-"+(r||"").replace(/\s/g,""),text:r,imageClass:"",attr:"",iconClass:""};if(!r&&(!f(e)||!e.template))throw new Error("Custom commands should have name specified");return f(e)?(e.className&&(e.className+=" "+i.className),r==="edit"&&f(e.text)&&(e=l(!0,{},e),e.text=e.text.edit),e.attr&&f(e.attr)&&(e.attr=tt(e.attr)),i=l(!0,i,nt[r],e)):i=l(!0,i,nt[r]),n.template(t)(i)},_groupable:function(){var t=this;t.table.on(U+C,".k-grouping-row .k-i-collapse, .k-grouping-row .k-i-expand",function(n){var r=e(this),i=r.closest("tr");r.hasClass("k-i-collapse")?t.collapseGroup(i):t.expandGroup(i),n.preventDefault(),n.stopPropagation()}),t._attachGroupable()},_attachGroupable:function(){var t=this,r=t.wrapper,i=t.options.groupable;i&&(r.has("div.k-grouping-header")[0]||e("<div />").addClass("k-grouping-header").prependTo(r),t.groupable&&t.groupable.destroy(),t.groupable=new s(r,l({},i,{draggable:t._draggableInstance,groupContainer:">div.k-grouping-header",dataSource:t.dataSource,filter:".k-header:not(.k-group-cell,.k-hierarchy-cell):visible["+n.attr("field")+"]",allowDrag:t.options.reorderable})))},_selectable:function(){var e=this,t,r,i=e.options.selectable;i&&(t=typeof i===V&&i.toLowerCase().indexOf("multiple")>-1,r=typeof i===V&&i.toLowerCase().indexOf("cell")>-1,e.selectable=new n.ui.Selectable(e.table,{filter:">"+(r?S:"tbody>tr:not(.k-grouping-row,.k-detail-row,.k-group-footer)"),aria:!0,multiple:t,change:function(){e.trigger(M)}}),e.options.navigatable&&e.table.on("keydown"+C,function(n){var i=e.current();n.keyCode===a.SPACEBAR&&n.target==e.table[0]&&!i.is(".k-edit-cell,.k-header")&&i.parent().is(":not(.k-grouping-row,.k-detail-row,.k-group-footer)")&&(n.preventDefault(),n.stopPropagation(),i=r?i:i.parent(),t?n.ctrlKey?i.hasClass(I)&&(i.removeClass(I),i=null):e.selectable.clear():e.selectable.clear(),e.selectable.value(i))}))},clearSelection:function(){var e=this;e.selectable.clear(),e.trigger(M)},select:function(t){var n=this,r=n.selectable;t=e(t);if(t.length){r.options.multiple||(r.clear(),t=t.first()),r.value(t);return}return r.value()},current:function(e){var n=this,r=n.options.scrollable,i=n._current,s=n.table.add(n.thead.parent());return e!==t&&e.length&&(!i||i[0]!==e[0])&&(i&&(i.removeClass(F).removeAttr("id"),s.removeAttr("aria-activedescendant")),e.attr("id",n._cellId),n._current=e.addClass(F),s.attr("aria-activedescendant",n._cellId),e.length&&r&&(n._scrollTo(e.parent()[0],n.content[0]),r.virtual?n._scrollTo(e[0],n.content.find(">.k-virtual-scrollable-wrap")[0]):n._scrollTo(e[0],n.content[0]))),n._current},_removeCurrent:function(){this._current&&(this._current.removeClass(F),this._current=null)},_scrollTo:function(e,t){var n=e.tagName.toLowerCase()==="td",r=e[n?"offsetLeft":"offsetTop"],i=e[n?"offsetWidth":"offsetHeight"],s=t[n?"scrollLeft":"scrollTop"],o=t[n?"clientWidth":"clientHeight"],u=r+i;t[n?"scrollLeft":"scrollTop"]=s>r?r:u>s+o?u-o:s},_navigatable:function(){var t=this,r=v(t.current,t),i=t.table,s=t.thead.parent(),o=i;if(!t.options.navigatable)return;t.options.scrollable&&(o=i.add(s),s.attr(W,-1)),s.on("keydown"+C,function(e){e.altKey&&e.keyCode==a.DOWN&&(r().find(".k-grid-filter, .k-header-column-menu").click(),e.stopImmediatePropagation())}).find("a.k-link").attr("tabIndex",-1),i.attr(W,y.max(i.attr(W)||0,0)).on("mousedown"+C+" keydown"+C,".k-detail-cell",function(e){e.target!==e.currentTarget&&e.stopImmediatePropagation()}),o.on("mousedown"+C,x+">"+T,v(dt,t)).on("focus"+C,function(t){var n=r();n&&n.is(":visible")?n.addClass(F):r(e(this).find(N)),this==i[0]?(s.attr(W,-1),i.attr(W,0)):(i.attr(W,-1),s.attr(W,0))}).on("focusout"+C,function(e){var t=r();t&&t.removeClass(F)}).on("keydown"+C,function(s){var o=s.keyCode,u=!1,f=!s.isDefaultPrevented()&&!e(s.target).is(":button,a,:input,a>.k-icon"),l=t.options.pageable,c=t.dataSource,h=t._editMode()=="incell",p,d,v,m=s.shiftKey,g=n.support.browser,y=r();y&&y.is("th")&&(f=!0);if(f&&o==a.UP){if(y){d=y.parent().prevAll(x).first(),d[0]||(d=t.thead.parent().focus().find(x).first()),v=y.index(),y=d.children().eq(v);if(!y[0]||!y.is(T))y=d.children(T).first()}else y=i.find(N);u=!0,r(y)}else if(f&&o==a.DOWN){if(y){d=y.parent().nextAll(x).first(),!d[0]&&y.is("th")&&(d=t.tbody.parent().focus().end().find(x).first()),v=y.index(),y=d.children().eq(v);if(!y[0]||!y.is(T))y=d.children(T).first()}else y=i.find(N);u=!0,r(y)}else if(f&&o==a.LEFT)r(y?y.prevAll(E+":first"):i.find(N)),u=!0;else if(f&&o==a.RIGHT)y?y.next()[0]&&(y=y.nextAll(E+":first")):y=i.find(N),u=!0,r(y);else if(f&&l&&a.PAGEDOWN==o)c.page(c.page()+1),u=!0;else if(f&&l&&a.PAGEUP==o)c.page(c.page()-1),u=!0;else if(o==a.ENTER||a.F2==o){y=y?y:i.find(N);if(y.is("th"))y.find(".k-link").click(),u=!0;else if(y.parent().is(".k-master-row,.k-grouping-row"))y.parent().find(".k-icon:first").click(),u=!0;else{var b=y.find(":focusable:first");!y.hasClass("k-edit-cell")&&b[0]&&y.hasClass("k-state-focused")?(b.focus(),u=!0):t.options.editable&&!e(s.target).is(":button,.k-button")&&(t._handleEditing(y),u=!0)}}else if(a.ESC==o)y&&e.contains(y[0],document.activeElement)&&!y.hasClass("k-edit-cell")&&!y.parent().hasClass("k-grid-edit-row")?(t.table[0].focus(),u=!0):t._editContainer&&(!y||t._editContainer.has(y[0])||y[0]===t._editContainer[0])&&(h?t.closeCell():(p=t.items().index(e(y).parent()),document.activeElement.blur(),t.cancelRow(),p>=0&&t.current(t.items().eq(p).children().filter(T).first())),g.msie&&parseInt(g.version,10)<9&&document.body.focus(),i.focus(),u=!0);else if(a.TAB==o){var w;y=e(y),t.options.editable&&h&&(w=e(document.activeElement).closest(".k-edit-cell"),w[0]&&w[0]!==y[0]&&(y=w)),w=m?y.prevAll(E+":first"):y.nextAll(":visible:first"),w.length||(w=y.parent()[m?"prevAll":"nextAll"]("tr:not(.k-grouping-row):not(.k-detail-row):visible:first").children(E+(m?":last":":first"))),!y.is("th")&&w.length&&t.options.editable&&h&&(t._handleEditing(y,w),u=!0)}u&&(s.preventDefault(),s.stopPropagation())})},_handleEditing:function(t,n){var r=this,i=r._editMode(),s=r._editContainer,o,u;i=="incell"?u=t.hasClass("k-edit-cell"):u=t.parent().hasClass("k-grid-edit-row");if(r.editable){e.contains(s[0],document.activeElement)&&e(document.activeElement).blur();if(!r.editable){r.table.focus();return}if(!r.editable.end()){i=="incell"?r.current(s):r.current(s.children().filter(E).first()),o=s.find(":focusable:first")[0],o&&o.focus();return}i=="incell"?r.closeCell():(r.saveRow(),u=!0)}n&&r.current(n),r.table.focus();if(!u&&!n||n)i=="incell"?r.editCell(r.current()):r.editRow(r.current().parent())},_wrapper:function(){var e=this,t=e.table,n=e.options.height,r=e.element;r.is("div")||(r=r.wrap("<div/>").parent()),e.wrapper=r.addClass("k-grid k-widget"),n&&(e.wrapper.css(z,n),t.css(z,"auto"))},_tbody:function(){var t=this,n=t.table,r;r=n.find(">tbody"),r.length||(r=e("<tbody/>").appendTo(n)),t.tbody=r},_scrollable:function(){var t=this,r,i,s=t.options,o=s.scrollable,u=n.support.scrollbar();if(o){r=t.wrapper.children(".k-grid-header"),r[0]||(r=e('<div class="k-grid-header" />').insertBefore(t.table)),r.css(Y?"padding-left":"padding-right",o.virtual?u+1:u),i=e('<table role="grid" cellspacing="0" />'),i.append(t.thead),r.empty().append(e('<div class="k-grid-header-wrap" />').append(i)),t.content=t.table.parent(),t.content.is(".k-virtual-scrollable-wrap")&&(t.content=t.content.parent()),t.content.is(".k-grid-content, .k-virtual-scrollable-wrap")||(t.content=t.table.wrap('<div class="k-grid-content" />').parent()),o!==!0&&o.virtual&&!t.virtualScrollable&&(t.virtualScrollable=new Z(t.content,{dataSource:t.dataSource,itemHeight:v(t._averageRowHeight,t)})),t.scrollables=r.children(".k-grid-header-wrap");var a=t.wrapper.find(".k-grid-footer"),f=Y&&e.browser.webkit?u:0;a.length&&(t.scrollables=t.scrollables.add(a.children(".k-grid-footer-wrap")));if(o.virtual)t.content.find(">.k-virtual-scrollable-wrap").bind("scroll"+C,function(){t.scrollables.scrollLeft(this.scrollLeft+f)});else{t.content.bind("scroll"+C,function(){t.scrollables.scrollLeft(this.scrollLeft+f)});var l=n.touchScroller(t.content);l&&l.movable&&l.movable.bind("change",function(e){t.scrollables.scrollLeft(-e.sender.x)})}}},_setContentHeight:function(){var e=this,t=e.options,r=e.wrapper.innerHeight(),i=e.wrapper.children(".k-grid-header"),s=n.support.scrollbar();if(t.scrollable){r-=i.outerHeight(),e.pager&&(r-=e.pager.element.outerHeight()),t.groupable&&(r-=e.wrapper.children(".k-grouping-header").outerHeight()),t.toolbar&&(r-=e.wrapper.children(".k-grid-toolbar").outerHeight()),e.footerTemplate&&(r-=e.wrapper.children(".k-grid-footer").outerHeight());var o=function(e){var t,n;return e[0].style.height?!0:(t=e.height(),e.height("auto"),n=e.height(),t!=n?(e.height(""),!0):(e.height(""),!1))};o(e.wrapper)&&(r>s*2?e.content.height(r):e.content.height(s*2+1))}},_averageRowHeight:function(){var e=this,t=e._rowHeight;e._rowHeight||(e._rowHeight=t=e.table.outerHeight()/e.table[0].rows.length,e._sum=t,e._measures=1);var n=e.table.outerHeight()/e.table[0].rows.length;return t!==n&&(e._measures++,e._sum+=n,e._rowHeight=e._sum/e._measures),t},_dataSource:function(){var e=this,n=e.options,r,s=n.dataSource;s=p(s)?{data:s}:s,f(s)&&(l(s,{table:e.table,fields:e.columns}),r=n.pageable,f(r)&&r.pageSize!==t&&(s.pageSize=r.pageSize)),e.dataSource&&e._refreshHandler?e.dataSource.unbind(M,e._refreshHandler).unbind(b,e._requestStartHandler).unbind(w,e._errorHandler):(e._refreshHandler=v(e.refresh,e),e._requestStartHandler=v(e._requestStart,e),e._errorHandler=v(e._error,e)),e.dataSource=i.create(s).bind(M,e._refreshHandler).bind(b,e._requestStartHandler).bind(w,e._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_modelChange:function(t){var i=this,s=t.model,o=i.tbody.find("tr["+n.attr("uid")+"="+s.uid+"]"),u,a,f=o.hasClass("k-alt"),l,c,h;if(o.children(".k-edit-cell").length&&!i.options.rowTemplate)o.children(":not(.k-group-cell,.k-hierarchy-cell)").each(function(){u=e(this),a=i.columns[i.cellIndex(u)],a.field===t.field&&(u.hasClass("k-edit-cell")?u.addClass("k-dirty-cell"):(i._displayCell(u,a,s),e('<span class="k-dirty"/>').prependTo(u)))});else if(!o.hasClass("k-grid-edit-row")){l=e((f?i.altRowTemplate:i.rowTemplate)(s)),o.replaceWith(l);for(c=0,h=i.columns.length;c<h;c++)a=i.columns[c],a.field===t.field&&(u=l.children(":not(.k-group-cell,.k-hierarchy-cell)").eq(c),e('<span class="k-dirty"/>').prependTo(u));i.trigger("itemChange",{item:l,data:s,ns:r})}},_pageable:function(){var t=this,r,i=t.options.pageable;i&&(r=t.wrapper.children("div.k-grid-pager"),r.length||(r=e('<div class="k-pager-wrap k-grid-pager"/>').appendTo(t.wrapper)),t.pager&&t.pager.destroy(),typeof i=="object"&&i instanceof n.ui.Pager?t.pager=i:t.pager=new n.ui.Pager(r,l({},i,{dataSource:t.dataSource})))},_footer:function(){var t=this,n=t.dataSource.aggregates(),r="",i=t.footerTemplate,s=t.options,o=t.footer||t.wrapper.find(".k-grid-footer");if(i){n=g(n)?st(t.dataSource.aggregate()):n,r=e(t._wrapFooter(i(n)));if(o.length){var u=r;o.replaceWith(u),o=t.footer=u}else s.scrollable?o=t.footer=s.pageable?r.insertBefore(t.wrapper.children("div.k-grid-pager")):r.appendTo(t.wrapper):o=t.footer=r.insertBefore(t.tbody)}else o&&!t.footer&&(t.footer=o);o.length&&(s.scrollable&&(t.scrollables=t.scrollables.not(".k-grid-footer-wrap").add(t.footer.attr("tabindex",-1).children(".k-grid-footer-wrap"))),s.resizable&&
t._footerWidth&&o.find("table").css("width",t._footerWidth))},_wrapFooter:function(t){var r=this,i="";return r.options.scrollable?(i=e('<div class="k-grid-footer"><div class="k-grid-footer-wrap"><table cellspacing="0"><tbody>'+t+"</tbody></table></div></div>"),r._appendCols(i.find("table")),i.css(Y?"padding-left":"padding-right",n.support.scrollbar()),i):'<tfoot class="k-grid-footer">'+t+"</tfoot>"},_columnMenu:function(){var t=this,r,i=t.columns,s,o=t.options,u=o.columnMenu,a,f,c,h=function(){t.thead.parent().focus()},p;u&&(typeof u=="boolean"&&(u={}),t.thead.find("th:not(.k-hierarchy-cell,.k-group-cell)").each(function(d){s=i[d],p=e(this),!s.command&&(s.field||p.attr("data-"+n.ns+"field"))&&(r=p.data("kendoColumnMenu"),r&&r.destroy(),f=s.sortable!==!1&&u.sortable!==!1?o.sortable:!1,c=o.filterable&&s.filterable!==!1&&u.filterable!==!1?l({},s.filterable,o.filterable):!1,a={dataSource:t.dataSource,values:s.values,columns:u.columns,sortable:f,filterable:c,messages:u.messages,owner:t,closeCallback:h},p.kendoColumnMenu(a))}))},_filterable:function(){var t=this,r=t.columns,i,s,o=function(){t.thead.parent().focus()},u=t.options.filterable;u&&!t.options.columnMenu&&t.thead.find("th:not(.k-hierarchy-cell,.k-group-cell)").each(function(a){i=e(this),r[a].filterable!==!1&&!r[a].command&&(r[a].field||i.attr("data-"+n.ns+"field"))&&(s=i.data("kendoFilterMenu"),s&&s.destroy(),i.kendoFilterMenu(l(!0,{},u,r[a].filterable,{dataSource:t.dataSource,values:r[a].values,closeCallback:o})))})},_sortable:function(){var t=this,r=t.columns,i,s=t.options.sortable;s&&t.thead.find("th:not(.k-hierarchy-cell,.k-group-cell)").each(function(o){i=r[o],i.sortable!==!1&&!i.command&&i.field&&e(this).attr("data-"+n.ns+"field",i.field).kendoSortable(l({},s,{dataSource:t.dataSource,aria:!0}))})},_columns:function(t){var r=this,i=r.table,s,o=i.find("col"),u=r.options.dataSource;t=t.length?t:c(i.find("th"),function(t,r){t=e(t);var i=t.attr(n.attr("sortable")),s=t.attr(n.attr("filterable")),u=t.attr(n.attr("type")),a=t.attr(n.attr("groupable")),f=t.attr(n.attr("field")),l=t.attr(n.attr("menu"));return f||(f=t.text().replace(/\s|[^A-z0-9]/g,"")),{field:f,type:u,sortable:i!=="false",filterable:s!=="false",groupable:a!=="false",menu:l,template:t.attr(n.attr("template")),width:o.eq(r).css("width")}}),s=!(r.table.find("tbody tr").length>0&&(!u||!u.transport)),r.columns=c(t,function(e){return e=typeof e===V?{field:e}:e,e.hidden&&(e.attributes=ft(e.attributes),e.footerAttributes=ft(e.footerAttributes),e.headerAttributes=ft(e.headerAttributes)),l({encoded:s},e)})},_groups:function(){var e=this.dataSource.group();return e?e.length:0},_tmpl:function(e,t){var r=this,i=l({},n.Template,r.options.templateSettings),s,o=r.columns.length,u,a={storage:{},count:0},f,c,h=r._hasDetails(),p=[],d=r._groups();if(!e){e="<tr",t&&p.push("k-alt"),h&&p.push("k-master-row"),p.length&&(e+=' class="'+p.join(" ")+'"'),o&&(e+=" "+n.attr("uid")+'="#='+i.paramName+'.uid#"'),e+=" role='row'>",d>0&&(e+=et(d)),h&&(e+='<td class="k-hierarchy-cell"><a class="k-icon k-plus" href="\\#" tabindex="-1"></a></td>');for(s=0;s<o;s++)f=r.columns[s],u=f.template,c=typeof u,e+="<td"+tt(f.attributes)+" role='gridcell'>",e+=r._cellTmpl(f,a),e+="</td>";e+="</tr>"}return e=n.template(e,i),a.count>0?v(e,a.storage):e},_headerCellText:function(e){var t=this,r=l({},n.Template,t.options.templateSettings),i=e.headerTemplate,s=typeof i,o=e.title||e.field||"";return s===X?o=n.template(i,r)({}):s===V&&(o=i),o},_cellTmpl:function(e,t){var r=this,i=l({},n.Template,r.options.templateSettings),s=e.template,o=i.paramName,u=e.field,a="",c,h,d=e.format,v=typeof s,m=e.values;if(e.command){if(p(e.command)){for(c=0,h=e.command.length;c<h;c++)a+=r._createButton(e.command[c]);return a.replace(Q,"\\#")}return r._createButton(e.command).replace(Q,"\\#")}return v===X?(t.storage["tmpl"+t.count]=s,a+="#=this.tmpl"+t.count+"("+o+")#",t.count++):v===V?a+=s:m&&m.length&&f(m[0])&&"value"in m[0]?(a+="#var v ="+n.stringify(m)+"#",a+="#for (var idx=0,length=v.length;idx<length;idx++) {#",a+="#if (v[idx].value == ",i.useWithBlock||(a+=o+"."),a+=u,a+=") { #",a+="${v[idx].text}",a+="#break;#",a+="#}#",a+="#}#"):(a+=e.encoded?"${":"#=",d&&(a+='kendo.format("'+d.replace(J,"\\$1")+'",'),u?(u=o+"."+u,a+=u+"==null?'':"+u):a+="''",d&&(a+=")"),a+=e.encoded?"}":"#"),a},_templates:function(){var t=this,n=t.options,r=t.dataSource,i=r.group(),s=t.footer||t.wrapper.find(".k-grid-footer"),o=r.aggregate();t.rowTemplate=t._tmpl(n.rowTemplate),t.altRowTemplate=t._tmpl(n.altRowTemplate||n.rowTemplate,!0),t._hasDetails()&&(t.detailTemplate=t._detailTmpl(n.detailTemplate||""));if(!g(o)&&!s.length||h(t.columns,function(e){return e.footerTemplate}).length)t.footerTemplate=t._footerTmpl(o,"footerTemplate","k-footer-template");i&&h(t.columns,function(e){return e.groupFooterTemplate}).length&&(o=e.map(i,function(e){return e.aggregates}),t.groupFooterTemplate=t._footerTmpl(o,"groupFooterTemplate","k-group-footer"))},_footerTmpl:function(e,t,r){var i=this,s=l({},n.Template,i.options.templateSettings),o=s.paramName,u="",a,f,c=i.columns,h,p,d={},m=0,g={},y=i._groups(),b=st(e),w;u+='<tr class="'+r+'">',y>0&&(u+=et(y)),i._hasDetails()&&(u+='<td class="k-hierarchy-cell">&nbsp;</td>');for(a=0,f=i.columns.length;a<f;a++)w=c[a],h=w[t],p=typeof h,u+="<td"+tt(w.footerAttributes)+">",h?(p!==X&&(g=b[w.field]?l({},s,{paramName:o+"."+w.field}):{},h=n.template(h,g)),d["tmpl"+m]=h,u+="#=this.tmpl"+m+"("+o+")#",m++):u+="&nbsp;",u+="</td>";return u+="</tr>",u=n.template(u,s),m>0?v(u,d):u},_detailTmpl:function(e){var t=this,r="",i=l({},n.Template,t.options.templateSettings),s=i.paramName,o={},u=0,a=t._groups(),f=at(t.columns).length,c=typeof e;return r+='<tr class="k-detail-row">',a>0&&(r+=et(a)),r+='<td class="k-hierarchy-cell"></td><td class="k-detail-cell"'+(f?' colspan="'+f+'"':"")+">",c===X?(o["tmpl"+u]=e,r+="#=this.tmpl"+u+"("+s+")#",u++):r+=e,r+="</td></tr>",r=n.template(r,i),u>0?v(r,o):r},_hasDetails:function(){var e=this;return e.options.detailTemplate!==null||(e._events[O]||[]).length},_details:function(){var t=this;t.table.on(U+C,".k-hierarchy-cell .k-plus, .k-hierarchy-cell .k-minus",function(n){var r=e(this),i=r.hasClass("k-plus"),s=r.closest("tr.k-master-row"),o,u=t.detailTemplate,a,f=t._hasDetails();return r.toggleClass("k-plus",!i).toggleClass("k-minus",i),f&&!s.next().hasClass("k-detail-row")&&(a=t.dataItem(s),e(u(a)).addClass(s.hasClass("k-alt")?"k-alt":"").insertAfter(s),t.trigger(O,{masterRow:s,detailRow:s.next(),data:a,detailCell:s.next().find(".k-detail-cell")})),o=s.next(),t.trigger(i?B:j,{masterRow:s,detailRow:o}),o.toggle(i),t._current&&t._current.attr("aria-expanded",i),n.preventDefault(),!1})},dataItem:function(t){return this._data[this.tbody.find("> tr:not(.k-grouping-row,.k-detail-row,.k-group-footer)").index(e(t))]},expandRow:function(t){e(t).find("> td .k-plus, > td .k-i-expand").click()},collapseRow:function(t){e(t).find("> td .k-minus, > td .k-i-collapse").click()},_thead:function(){var r=this,i=r.columns,s=r._hasDetails()&&i.length,o,u,a="",f=r.table.find(">thead"),l,c,h;f.length||(f=e("<thead/>").insertBefore(r.tbody)),l=r.element.find("tr:has(th):first"),l.length||(l=f.children().first(),l.length||(l=e("<tr/>")));if(!l.children().length){s&&(a+='<th class="k-hierarchy-cell">&nbsp;</th>');for(o=0,u=i.length;o<u;o++)h=i[o],c=r._headerCellText(h),h.command?a+="<th"+tt(h.headerAttributes)+">"+c+"</th>":(a+="<th role='columnheader' "+n.attr("field")+"='"+(h.field||"")+"' ",h.title&&(a+=n.attr("title")+'="'+h.title.replace(/'/g,"'")+'" '),h.groupable!==t&&(a+=n.attr("groupable")+"='"+h.groupable+"' "),h.aggregates&&(a+=n.attr("aggregates")+"='"+h.aggregates+"'"),a+=tt(h.headerAttributes),a+=">"+c+"</th>");l.html(a)}else s&&!l.find(".k-hierarchy-cell")[0]&&l.prepend('<th class="k-hierarchy-cell">&nbsp;</th>');l.find("th").addClass("k-header"),r.options.scrollable||f.addClass("k-grid-header"),l.find("script").remove().end().appendTo(f),r.thead=f,r._sortable(),r._filterable(),r._scrollable(),r._updateCols(),r._resizable(),r._draggable(),r._reorderable(),r.groupable&&r._attachGroupable(),r._columnMenu()},_updateCols:function(){var e=this;e._appendCols(e.thead.parent().add(e.table))},_appendCols:function(e){var t=this;ct(e,at(t.columns),t._hasDetails(),t._groups())},_autoColumns:function(e){if(e&&e.toJSON){var t=this,n;e=e.toJSON();for(n in e)t.columns.push({field:n});t._thead(),t._templates()}},_rowsHtml:function(e){var t=this,n="",r,i,s=t.rowTemplate,o=t.altRowTemplate;for(r=0,i=e.length;r<i;r++)r%2?n+=o(e[r]):n+=s(e[r]),t._data.push(e[r]);return n},_groupRowHtml:function(e,t,r){var i=this,s="",o,u,a=e.field,f=h(i.columns,function(e){return e.field==a})[0]||{},c=f.format?n.format(f.format,e.value):e.value,p=f.groupHeaderTemplate,d=(f.title||a)+": "+c,v=l({},{field:e.field,value:e.value},e.aggregates[e.field]),m=i._groupAggregatesDefaultObject||{},g=e.items;p&&(d=typeof p===X?p(v):n.template(p)(v)),s+='<tr class="k-grouping-row">'+et(r)+'<td colspan="'+t+'" aria-expanded="true">'+'<p class="k-reset">'+'<a class="k-icon k-i-collapse" href="#" tabindex="-1"></a>'+d+"</p></td></tr>";if(e.hasSubgroups)for(o=0,u=g.length;o<u;o++)s+=i._groupRowHtml(g[o],t-1,r+1);else s+=i._rowsHtml(g);return i.groupFooterTemplate&&(s+=i.groupFooterTemplate(l(m,e.aggregates))),s},collapseGroup:function(t){t=e(t).find(".k-icon").addClass("k-i-expand").removeClass("k-i-collapse").end();var n=t.find(".k-group-cell").length,r=1,i,s;t.find("td:first").attr("aria-expanded",!1),t.nextAll("tr").each(function(){s=e(this),i=s.find(".k-group-cell").length,s.hasClass("k-grouping-row")?r++:s.hasClass("k-group-footer")&&r--;if(i<=n||s.hasClass("k-group-footer")&&r<0)return!1;s.hide()})},expandGroup:function(t){t=e(t).find(".k-icon").addClass("k-i-collapse").removeClass("k-i-expand").end();var n=this,r=t.find(".k-group-cell").length,i,s,o=1;t.find("td:first").attr("aria-expanded",!0),t.nextAll("tr").each(function(){i=e(this),s=i.find(".k-group-cell").length;if(s<=r)return!1;s==r+1&&!i.hasClass("k-detail-row")&&(i.show(),i.hasClass("k-grouping-row")&&i.find(".k-icon").hasClass("k-i-collapse")&&n.expandGroup(i),i.hasClass("k-master-row")&&i.find(".k-icon").hasClass("k-minus")&&i.next().show()),i.hasClass("k-grouping-row")&&o++,i.hasClass("k-group-footer")&&(o==1?i.show():o--)})},_updateHeader:function(t){var n=this,r=n.thead.find("th.k-group-cell"),i=r.length;t>i?e((new Array(t-i+1)).join('<th class="k-group-cell k-header">&nbsp;</th>')).prependTo(n.thead.find("tr")):t<i&&(i-=t,e(h(r,function(e,t){return i>t})).remove())},_firstDataItem:function(e,t){return e&&t&&(e.hasSubgroups?e=this._firstDataItem(e.items[0],t):e=e.items[0]),e},hideColumn:function(t){var n=this,r,i,s,o,u,a,f,l=0,c,p=n.footer||n.wrapper.find(".k-grid-footer"),v=n.columns,m;typeof t=="number"?t=v[t]:t=h(v,function(e){return e.field===t})[0];if(!t||t.hidden)return;m=d(t,at(v)),t.hidden=!0,t.attributes=ft(t.attributes),t.footerAttributes=ft(t.footerAttributes),t.headerAttributes=ft(t.headerAttributes),n._templates(),n._updateCols(),n.thead.find(">tr>th:not(.k-hierarchy-cell,.k-group-cell):visible").eq(m).hide(),p&&(n._appendCols(p.find("table:first")),p.find(".k-footer-template>td:not(.k-hierarchy-cell,.k-group-cell):visible").eq(m).hide()),r=n.tbody.children();for(u=0,c=r.length;u<c;u+=1)i=r.eq(u),i.is(".k-grouping-row,.k-detail-row")?(s=i.children(":not(.k-group-cell):first,.k-detail-cell").last(),s.attr("colspan",parseInt(s.attr("colspan"),10)-1)):(i.hasClass("k-grid-edit-row")&&(s=i.children(".k-edit-container")[0])&&(s=e(s),s.attr("colspan",parseInt(s.attr("colspan"),10)-1),s.find("col").eq(m).remove(),i=s.find("tr:first")),i.children(":not(.k-group-cell,.k-hierarchy-cell):visible").eq(m).hide());a=n.thead.prev().find("col");for(u=0,c=a.length;u<c;u+=1){f=a[u].style.width;if(!f||f.indexOf("%")!=-1){l=0;break}l+=parseInt(f,10)}o=e(">.k-grid-header table:first,>.k-grid-footer table:first",n.wrapper).add(n.table),l&&o.width(l),e.browser.msie&&parseInt(e.browser.version,10)==8&&(o.css("display","inline-table"),setTimeout(function(){o.css("display","table")},1)),n.trigger(_,{column:t})},showColumn:function(t){var n=this,r,i,s,o,u,a,f,l,c,p=n.columns,v=n.footer||n.wrapper.find(".k-grid-footer"),m;typeof t=="number"?t=p[t]:t=h(p,function(e){return e.field===t})[0];if(!t||!t.hidden)return;m=d(t,p),t.hidden=!1,t.attributes=lt(t.attributes),t.footerAttributes=lt(t.footerAttributes),t.headerAttributes=lt(t.headerAttributes),n._templates(),n._updateCols(),n.thead.find(">tr>th:not(.k-hierarchy-cell,.k-group-cell)").eq(m).show(),v&&(n._appendCols(v.find("table:first")),v.find(".k-footer-template>td:not(.k-hierarchy-cell,.k-group-cell)").eq(m).show()),r=n.tbody.children();for(i=0,s=r.length;i<s;i+=1)o=r.eq(i),o.is(".k-grouping-row,.k-detail-row")?(u=o.children(":not(.k-group-cell):first,.k-detail-cell").last(),u.attr("colspan",parseInt(u.attr("colspan"),10)+1)):(o.hasClass("k-grid-edit-row")&&(u=o.children(".k-edit-container")[0])&&(u=e(u),u.attr("colspan",parseInt(u.attr("colspan"),10)+1),ct(u.find(">form>table"),at(p),!1,0),o=u.find("tr:first")),o.children(":not(.k-group-cell,.k-hierarchy-cell)").eq(m).show());a=e(">.k-grid-header table:first,>.k-grid-footer table:first",n.wrapper).add(n.table);if(!t.width)a.width("");else{f=0,c=n.thead.prev().find("col");for(i=0,s=c.length;i<s;i+=1){l=c[i].style.width;if(l.indexOf("%")>-1){f=0;break}f+=parseInt(l,10)}f&&a.width(f)}n.trigger(D,{column:t})},_progress:function(e){var t=this,r=t.element.is("table")?t.element.parent():t.content&&t.content.length?t.content:t.element;n.ui.progress(r,e)},refresh:function(t){var n=this,r,i,s="",u=n.dataSource.view(),a=n.options.navigatable,f,l,c,h=e(n.current()),p=!1,d=(n.dataSource.group()||[]).length,v=d+at(n.columns).length;if(t&&t.action==="itemchange"&&n.editable)return;t=t||{};if(n.trigger("dataBinding",{action:t.action||"rebind",index:t.index,items:t.items}))return;a&&(n.table[0]===document.activeElement||e.contains(n.table[0],document.activeElement))&&(p=h.is("th"),c=0,p&&(c=n.thead.find("th:not(.k-group-cell)").index(h))),n._destroyEditable(),n._progress(!1),n._data=[],n.columns.length||(n._autoColumns(n._firstDataItem(u[0],d)),v=d+n.columns.length),n._group=d>0||n._group,n._group&&(n._templates(),n._updateCols(),n._updateHeader(d),n._group=d>0);if(d>0){n.detailTemplate&&v++,n.groupFooterTemplate&&(n._groupAggregatesDefaultObject=st(n.dataSource.aggregate()));for(i=0,r=u.length;i<r;i++)s+=n._groupRowHtml(u[i],v,0)}else s+=n._rowsHtml(u);o?n.tbody[0].innerHTML=s:(l=document.createElement("div"),l.innerHTML="<table><tbody>"+s+"</tbody></table>",f=l.firstChild.firstChild,n.table[0].replaceChild(f,n.tbody[0]),n.tbody=e(f)),n._footer(),n._setContentHeight(),c>=0&&(n._removeCurrent(),p?n.current(n.thead.find("th:not(.k-group-cell)").eq(c)):n.current(n.items().eq(c).children().filter(E).first()),n._current.closest("table")[0].focus()),n.trigger(H)}});r.plugin(ht),r.plugin(Z)})(jQuery);