/*
* Kendo UI Beta v2012.3.1024 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

;(function(e,t){var n=window.kendo,r=n.mobile,i=n.fx,s=r.ui,o=e.proxy,u=e.extend,a=s.Widget,f=n.Class,l=n.ui.Movable,c=n.ui.Pane,h=n.ui.PaneDimensions,p=i.Transition,d=i.Animation,v=Math.abs,m=500,g=.7,y=.93,b=.5,w="km-scroller-release",E="km-scroller-refresh",S="pull",x="change",T="resize",N="scroll",C=d.extend({init:function(e){var t=this;d.fn.init.call(t),u(t,e),t.userEvents.bind("gestureend",o(t.start,t)),t.tapCapture.bind("press",o(t.cancel,t))},done:function(){return this.dimensions.minScale-this.movable.scale<.01},tick:function(){var e=this.movable;e.scaleWith(1.1),this.dimensions.rescale(e.scale)},onEnd:function(){var e=this.movable;e.scaleTo(this.dimensions.minScale),this.dimensions.rescale(e.scale)}}),k=d.extend({init:function(e){var t=this;d.fn.init.call(t),u(t,e,{transition:new p({axis:e.axis,movable:e.movable,onEnd:function(){t._end()}})}),t.tapCapture.bind("press",function(){t.cancel()}),t.userEvents.bind("end",o(t.start,t)),t.userEvents.bind("gestureend",o(t.start,t)),t.userEvents.bind("tap",o(t.onEnd,t))},onCancel:function(){this.transition.cancel()},freeze:function(e){var t=this;t.cancel(),t._moveTo(e)},onEnd:function(){var e=this;e._outOfBounds()?e._snapBack():e._end()},done:function(){return v(this.velocity)<1},start:function(e){var t=this;if(!t.dimension.enabled)return;t._outOfBounds()?t._snapBack():(t.velocity=e.touch[t.axis].velocity*16,t.velocity&&(t.tapCapture.captureNext(),d.fn.start.call(t)))},tick:function(){var e=this,t=e.dimension,n=e._outOfBounds()?b:y,r=e.velocity*=n,i=e.movable[e.axis]+r;!e.elastic&&t.outOfBounds(i)&&(i=Math.max(Math.min(i,t.max),t.min),e.velocity=0),e.movable.moveAxis(e.axis,i)},_end:function(){this.tapCapture.cancelCapture(),this.end()},_outOfBounds:function(){return this.dimension.outOfBounds(this.movable[this.axis])},_snapBack:function(){var e=this,t=e.dimension,n=e.movable[e.axis]>t.max?t.max:t.min;e._moveTo(n)},_moveTo:function(e){this.transition.moveTo({location:e,duration:m,ease:p.easeOutExpo})}}),L=f.extend({init:function(t){var n=this,r=t.axis==="x",i=e('<div class="km-touch-scrollbar km-'+(r?"horizontal":"vertical")+'-scrollbar" />');u(n,t,{element:i,elementSize:0,movable:new l(i),scrollMovable:t.movable,size:r?"width":"height"}),n.scrollMovable.bind(x,o(n._move,n)),n.container.append(i)},_move:function(){var e=this,t=e.axis,n=e.dimension,r=n.size,i=e.scrollMovable,s=r/n.total,o=Math.round(-i[t]*s),u=Math.round(r*s);o+u>r?u=r-o:o<0&&(u+=o,o=0),e.elementSize!=u&&(e.element.css(e.size,u+"px"),e.elementSize=u),e.movable.moveAxis(t,o)},show:function(){this.element.css({opacity:g,visibility:"visible"})},hide:function(){this.element.css({opacity:0})}}),A=a.extend({init:function(t,r){var i=this;a.fn.init.call(i,t,r),t=i.element,t.css("overflow","hidden").addClass("km-scroll-wrapper").wrapInner('<div class="km-scroll-container"/>').prepend('<div class="km-scroll-header"/>');var s=t.children().eq(1),o=new n.TapCapture(t),f=new l(s),p=new h({element:s,container:t,forcedEnabled:i.options.zoom,change:function(){i.trigger(T)}}),d=new n.UserEvents(t,{allowSelection:!0,preventDragEvent:!0,multiTouch:i.options.zoom,start:function(e){p.refresh();var t=v(e.x.velocity),n=v(e.y.velocity);p.x.enabled&&t*2>=n||p.y.enabled&&n*2>=t?d.capture():d.cancel()}}),m=new c({movable:f,dimensions:p,userEvents:d,elastic:i.options.elastic}),g=new C({movable:f,dimensions:p,userEvents:d,tapCapture:o});f.bind(x,function(){i.scrollTop=-f.y,i.scrollLeft=-f.x,i.trigger(N,{scrollTop:i.scrollTop,scrollLeft:i.scrollLeft})}),u(i,{movable:f,dimensions:p,zoomSnapBack:g,userEvents:d,pane:m,tapCapture:o,pulled:!1,scrollElement:s,fixedContainer:t.children().first()}),i._initAxis("x"),i._initAxis("y"),p.refresh(),i.options.pullToRefresh&&i._initPullToRefresh(),n.onResize(e.proxy(i.reset,i))},scrollHeight:function(){return this.scrollElement[0].scrollHeight},scrollWidth:function(){return this.scrollElement[0].scrollWidth},options:{name:"Scroller",zoom:!1,pullOffset:140,elastic:!0,pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing"},events:[S,N,T],setOptions:function(e){var t=this;a.fn.setOptions.call(t,e),e.pullToRefresh&&t._initPullToRefresh()},reset:function(){this.movable.moveTo({x:0,y:0})},scrollTo:function(e,t){this.movable.moveTo({x:e,y:t})},pullHandled:function(){var e=this;e.refreshHint.removeClass(E),e.hintContainer.html(e.pullTemplate({})),e.yinertia.onEnd(),e.xinertia.onEnd()},destroy:function(){a.fn.destroy.call(this),this.userEvents.destroy()},_initPullToRefresh:function(){var e=this;e.dimensions.y.forceEnabled(),e.pullTemplate=n.template(e.options.pullTemplate),e.releaseTemplate=n.template(e.options.releaseTemplate),e.refreshTemplate=n.template(e.options.refreshTemplate),e.scrollElement.prepend('<span class="km-scroller-pull"><span class="km-icon"></span><span class="km-template">'+e.pullTemplate({})+"</span></span>"),e.refreshHint=e.scrollElement.children().first(),e.hintContainer=e.refreshHint.children(".km-template"),e.pane.y.bind("change",o(e._paneChange,e)),e.userEvents.bind("end",o(e._dragEnd,e))},_dragEnd:function(){var e=this;if(!e.pulled)return;e.pulled=!1,e.refreshHint.removeClass(w).addClass(E),e.hintContainer.html(e.refreshTemplate({})),e.trigger("pull"),e.yinertia.freeze(e.options.pullOffset/2)},_paneChange:function(){var e=this;e.movable.y/b>e.options.pullOffset?e.pulled||(e.pulled=!0,e.refreshHint.removeClass(E).addClass(w),e.hintContainer.html(e.releaseTemplate({}))):e.pulled&&(e.pulled=!1,e.refreshHint.removeClass(w),e.hintContainer.html(e.pullTemplate({})))},_initAxis:function(e){var t=this,n=t.movable,r=t.dimensions[e],i=t.tapCapture,s=new L({axis:e,movable:n,dimension:r,container:t.element}),o=new k({axis:e,movable:n,tapCapture:i,userEvents:t.userEvents,dimension:r,elastic:t.options.elastic,end:function(){s.hide()}});t[e+"inertia"]=o,t.pane[e].bind(x,function(){s.show()})}});s.plugin(A)})(jQuery);