/*
* Kendo UI Beta v2012.3.1024 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

;(function(e,t){function b(t){return e.map(w(t),function(e){return e.name}).join(", ")}function w(e){var t=e[0];return t.files?E(t.files):[{name:T(t.value),extension:x(t.value),size:null}]}function E(t){return e.map(t,function(e){return S(e)})}function S(e){var t=e.name||e.fileName;return{name:t,extension:x(t),size:e.size||e.fileSize,rawFile:e}}function x(e){var t=e.match(s);return t?t[0]:""}function T(e){var t=e.lastIndexOf("\\");return t!=-1?e.substr(t+1):e}function N(t,n,r){if(!n._supportsRemove())return;var s=t.data("fileNames"),o=e.map(s,function(e){return e.name});n._submitRemove(o,r,function(r,i,o){n._removeFileEntry(t),n.trigger(f,{operation:"remove",files:s,response:r,XMLHttpRequest:o})},function(t,r){n.trigger(l,{operation:"remove",files:s,XMLHttpRequest:t}),i("Server response: "+t.responseText)})}function C(t,n,r){var i=!1,s="";try{s=e.parseJSON(t),i=!0}catch(o){r()}i&&n(s)}function k(e){e.stopPropagation(),e.preventDefault()}function L(e,t,n,r){var i,s;e.on("dragenter"+t,function(e){n(),s=new Date,i||(i=setInterval(function(){var e=new Date-s;e>100&&(r(),clearInterval(i),i=null)},100))}).on("dragover"+t,function(e){s=new Date})}function A(e){return e.children(".k-icon").is(".k-loading, .k-success, .k-fail")}function O(t){return e(t.target).closest(".k-file")}function M(){var n={},r=e("meta[name=csrf-token]").attr("content"),i=e("meta[name=csrf-param]").attr("content");return e("input[name^='__RequestVerificationToken']").each(function(){n[this.name]=this.value}),i!==t&&r!==t&&(n[i]=r),n}var n=window.kendo,r=n.ui.Widget,i=n.logToConsole,s=/\.([^\.]+)$/,o=".kendoUpload",u="select",a="upload",f="success",l="error",c="complete",h="cancel",p="progress",d="remove",v=r.extend({init:function(t,i){var s=this;r.fn.init.call(s,t,i),s.name=t.name,s.multiple=s.options.multiple,s.localization=s.options.localization;var u=s.element;s.wrapper=u.closest(".k-upload"),s.wrapper.length===0&&(s.wrapper=s._wrapInput(u)),s._activeInput(u),s.toggle(s.options.enabled);var a=s._ns=o+"-"+n.guid();u.closest("form").on("submit"+a,e.proxy(s._onParentFormSubmit,s)).on("reset"+a,e.proxy(s._onParentFormReset,s)),s.options.async.saveUrl?(s._module=s._supportsFormData()?new y(s):new g(s),s._async=!0):s._module=new m(s),s._supportsDrop()&&s._setupDropZone(),s.wrapper.delegate(".k-upload-action","click",e.proxy(s._onFileAction,s)).delegate(".k-upload-selected","click",e.proxy(s._onUploadSelected,s)).delegate(".k-file","t:progress",e.proxy(s._onFileProgress,s)).delegate(".k-file","t:upload-success",e.proxy(s._onUploadSuccess,s)).delegate(".k-file","t:upload-error",e.proxy(s._onUploadError,s))},events:[u,a,f,l,c,h,p,d],options:{name:"Upload",enabled:!0,multiple:!0,showFileList:!0,async:{removeVerb:"POST",autoUpload:!0},localization:{select:"Select...",cancel:"Cancel",retry:"Retry",remove:"Remove",uploadSelectedFiles:"Upload files",dropFilesHere:"drop files here to upload",statusUploading:"uploading",statusUploaded:"uploaded",statusFailed:"failed"}},setOptions:function(e){var t=this,n=t.element;r.fn.setOptions.call(t,e),t.multiple=t.options.multiple,n.attr("multiple",t._supportsMultiple()?t.multiple:!1),t.toggle(t.options.enabled)},enable:function(e){e=typeof e=="undefined"?!0:e,this.toggle(e)},disable:function(){this.toggle(!1)},toggle:function(e){e=typeof e=="undefined"?e:!e,this.wrapper.toggleClass("k-state-disabled",e)},destroy:function(){var t=this;e(document).add(e(".k-dropzone",t.wrapper)).add(t.wrapper.closest("form")).off(t._ns),r.fn.destroy.call(t)},_addInput:function(t){var n=this;t.insertAfter(n.element).data("kendoUpload",n),e(n.element).hide().removeAttr("id"),n._activeInput(t)},_activeInput:function(t){var n=this,r=n.wrapper;n.element=t,t.attr("multiple",n._supportsMultiple()?n.multiple:!1).attr("autocomplete","off").click(function(e){r.hasClass("k-state-disabled")&&e.preventDefault()}).change(e.proxy(n._onInputChange,n))},_onInputChange:function(t){var n=this,r=e(t.target),i=n.trigger(u,{files:w(r)});i?(n._addInput(r.clone().val("")),r.remove()):r.trigger("t:select")},_onDrop:function(t){var n=t.originalEvent.dataTransfer,r=this,i=n.files;k(t);if(i.length>0){var s=r.trigger(u,{files:E(i)});s||e(".k-dropzone",r.wrapper).trigger("t:select",[i])}},_enqueueFile:function(t,n){var r=this,i,s,o=e(".k-upload-files",r.wrapper);return o.length===0&&(o=e("<ul class='k-upload-files k-reset'></ul>").appendTo(r.wrapper),r.options.showFileList||o.hide()),i=e(".k-file",o),s=e("<li class='k-file'><span class='k-filename' title='"+t+"'>"+t+"</span></li>").appendTo(o).data(n),r._async&&s.prepend("<span class='k-icon'></span>"),r.multiple||i.trigger("t:remove"),s},_removeFileEntry:function(t){var n=t.closest(".k-upload-files"),r;t.remove(),r=e(".k-file",n),r.find("> .k-fail").length===r.length&&this._hideUploadButton(),r.length===0&&n.remove()},_fileAction:function(e,t){var n={remove:"k-delete",cancel:"k-cancel",retry:"k-retry"};if(!n.hasOwnProperty(t))return;this._clearFileAction(e),e.append(this._renderAction(n[t],this.localization[t]).addClass("k-upload-action"))},_fileState:function(e,t){var n=this.localization,r={uploading:{cssClass:"k-loading",text:n.statusUploading},uploaded:{cssClass:"k-success",text:n.statusUploaded},failed:{cssClass:"k-fail",text:n.statusFailed}},i=r[t];if(i){var s=e.children(".k-icon").text(i.text);s[0].className="k-icon "+i.cssClass}},_renderAction:function(t,n){return t!==""?e("<button type='button' class='k-button k-button-icontext'><span class='k-icon "+t+"'></span>"+n+"</button>"):e("<button type='button' class='k-button'>"+n+"</button>")},_clearFileAction:function(e){e.find(".k-upload-action").remove()},_onFileAction:function(t){var n=this;if(!n.wrapper.hasClass("k-state-disabled")){var r=e(t.target).closest(".k-upload-action"),i=r.find(".k-icon"),s=r.closest(".k-file"),o={files:s.data("fileNames")};i.hasClass("k-delete")?n.trigger(d,o)||s.trigger("t:remove",o.data):i.hasClass("k-cancel")?(n.trigger(h,o),s.trigger("t:cancel"),this._checkAllComplete()):i.hasClass("k-retry")&&s.trigger("t:retry")}return!1},_onUploadSelected:function(){return this.wrapper.trigger("t:saveSelected"),!1},_onFileProgress:function(t,n){var r=e(".k-progress-status",t.target);r.length===0&&(r=e("<span class='k-progress'><span class='k-state-selected k-progress-status' style='width: 0;'></span></span>").appendTo(e(".k-filename",t.target)).find(".k-progress-status")),r.width(n+"%"),this.trigger(p,{files:O(t).data("fileNames"),percentComplete:n})},_onUploadSuccess:function(e,t,n){var r=O(e);this._fileState(r,"uploaded"),this.trigger(f,{files:r.data("fileNames"),response:t,operation:"upload",XMLHttpRequest:n}),this._supportsRemove()?this._fileAction(r,d):this._clearFileAction(r),this._checkAllComplete()},_onUploadError:function(e,t){var n=O(e);this._fileState(n,"failed"),this._fileAction(n,"retry"),this.trigger(l,{operation:"upload",files:n.data("fileNames"),XMLHttpRequest:t}),i("Server response: "+t.responseText),this._checkAllComplete()},_showUploadButton:function(){var t=e(".k-upload-selected",this.wrapper);t.length===0&&(t=this._renderAction("",this.localization.uploadSelectedFiles).addClass("k-upload-selected")),this.wrapper.append(t)},_hideUploadButton:function(){e(".k-upload-selected",this.wrapper).remove()},_onParentFormSubmit:function(){var t=this,n=t.element;n.trigger("t:abort");if(!n.value){var r=e(n);r.attr("disabled","disabled"),window.setTimeout(function(){r.removeAttr("disabled")},0)}},_onParentFormReset:function(){e(".k-upload-files",this.wrapper).remove()},_supportsFormData:function(){return typeof FormData!="undefined"},_supportsMultiple:function(){var e=this._userAgent().indexOf("Windows")>-1;return!n.support.browser.opera&&(!n.support.browser.safari||!e)},_supportsDrop:function(){var e=this._userAgent().toLowerCase(),t=/chrome/.test(e),n=!t&&/safari/.test(e),r=n&&/windows/.test(e);return!r&&this._supportsFormData()&&this.options.async.saveUrl},_userAgent:function(){return navigator.userAgent},_setupDropZone:function(){var t=this;e(".k-upload-button",this.wrapper).wrap("<div class='k-dropzone'></div>");var n=t._ns,r=e(".k-dropzone",t.wrapper).append(e("<em>"+t.localization.dropFilesHere+"</em>")).on("dragenter"+n,k).on("dragover"+n,function(e){e.preventDefault()}).on("drop"+n,e.proxy(this._onDrop,this));L(r,n,function(){r.addClass("k-dropzone-hovered")},function(){r.removeClass("k-dropzone-hovered")}),L(e(document),n,function(){r.addClass("k-dropzone-active")},function(){r.removeClass("k-dropzone-active")})},_supportsRemove:function(){return!!this.options.async.removeUrl},_submitRemove:function(t,n,r,i){var s=this,o=s.options.async.removeField||"fileNames",u=e.extend(n,M());u[o]=t,e.ajax({type:this.options.async.removeVerb,dataType:"json",url:this.options.async.removeUrl,traditional:!0,data:u,success:r,error:i})},_wrapInput:function(e){return e.wrap("<div class='k-widget k-upload'><div class='k-button k-upload-button'></div></div>"),e.closest(".k-button").append("<span>"+this.localization.select+"</span>"),e.closest(".k-upload")},_checkAllComplete:function(){e(".k-file .k-icon.k-loading",this.wrapper).length===0&&this.trigger(c)}}),m=function(t){this.name="syncUploadModule",this.element=t.wrapper,this.upload=t,this.element.bind("t:select",e.proxy(this.onSelect,this)).bind("t:remove",e.proxy(this.onRemove,this)).closest("form").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data")};m.prototype={onSelect:function(t){var n=this.upload,r=e(t.target);n._addInput(r.clone().val(""));var i=n._enqueueFile(b(r),{relatedInput:r,fileNames:w(r)});n._fileAction(i,d)},onRemove:function(e){var t=O(e);t.data("relatedInput").remove(),this.upload._removeFileEntry(t)}};var g=function(t){this.name="iframeUploadModule",this.element=t.wrapper,this.upload=t,this.iframes=[],this.element.bind("t:select",e.proxy(this.onSelect,this)).bind("t:cancel",e.proxy(this.onCancel,this)).bind("t:retry",e.proxy(this.onRetry,this)).bind("t:remove",e.proxy(this.onRemove,this)).bind("t:saveSelected",e.proxy(this.onSaveSelected,this)).bind("t:abort",e.proxy(this.onAbort,this))};v._frameId=0,g.prototype={onSelect:function(t){var n=this.upload,r=e(t.target),i=this.prepareUpload(r);n.options.async.autoUpload?this.performUpload(i):(n._supportsRemove()&&this.upload._fileAction(i,d),n._showUploadButton())},prepareUpload:function(t){var n=this.upload,r=e(n.element),i=n.options.async.saveField||t.attr("name");n._addInput(t.clone().val("")),t.attr("name",i);var s=this.createFrame(n.name+"_"+v._frameId++);this.registerFrame(s);var o=this.createForm(n.options.async.saveUrl,s.attr("name")).append(r),u=n._enqueueFile(b(t),{frame:s,relatedInput:r,fileNames:w(t)});return s.data({form:o,file:u}),u},performUpload:function(t){var n={files:t.data("fileNames")},r=t.data("frame"),i=this.upload;if(!i.trigger(a,n)){i._hideUploadButton(),r.appendTo(document.body);var s=r.data("form").appendTo(document.body);n.data=e.extend({},n.data,M());for(var o in n.data){var u=s.find("input[name='"+o+"']");u.length===0&&(u=e("<input>",{type:"hidden",name:o}).appendTo(s)),u.val(n.data[o])}i._fileAction(t,h),i._fileState(t,"uploading"),r.one("load",e.proxy(this.onIframeLoad,this)),s[0].submit()}else i._removeFileEntry(r.data("file")),this.cleanupFrame(r),this.unregisterFrame(r)},onSaveSelected:function(t){var n=this;e(".k-file",this.element).each(function(){var t=e(this),r=A(t);r||n.performUpload(t)})},onIframeLoad:function(t){var n=e(t.target),r;try{r=n.contents().text()}catch(t){r="Error trying to get server response: "+t}this.processResponse(n,r)},processResponse:function(t,n){var r=t.data("file"),i=this,s={responseText:n};C(n,function(n){e.extend(s,{statusText:"OK",status:"200"}),r.trigger("t:progress",[100]),r.trigger("t:upload-success",[n,s]),i.cleanupFrame(t),i.unregisterFrame(t)},function(){e.extend(s,{statusText:"error",status:"500"}),r.trigger("t:upload-error",[s])})},onCancel:function(t){var n=e(t.target).data("frame");this.stopFrameSubmit(n),this.cleanupFrame(n),this.unregisterFrame(n),this.upload._removeFileEntry(n.data("file"))},onRetry:function(e){var t=O(e);this.performUpload(t)},onRemove:function(e,t){var n=O(e),r=n.data("frame");r?(this.unregisterFrame(r),this.upload._removeFileEntry(n),this.cleanupFrame(r)):N(n,this.upload,t)},onAbort:function(){var t=this.element,n=this;e.each(this.iframes,function(){e("input",this.data("form")).appendTo(t),n.stopFrameSubmit(this[0]),this.data("form").remove(),this.remove()}),this.iframes=[]},createFrame:function(t){return e("<iframe name='"+t+"'"+" id='"+t+"'"+" style='display:none;' />")},createForm:function(t,n){return e("<form enctype='multipart/form-data' method='POST' action='"+t+"'"+" target='"+n+"'"+"/>")},stopFrameSubmit:function(e){typeof e.stop!="undefined"?e.stop():e.document&&(e.document.execCommand("Stop"),e.contentWindow.location.href=e.contentWindow.location.href)},registerFrame:function(e){this.iframes.push(e)},unregisterFrame:function(t){this.iframes=e.grep(this.iframes,function(e){return e.attr("name")!=t.attr("name")})},cleanupFrame:function(e){var t=e.data("form");e.data("file").data("frame",null),setTimeout(function(){t.remove(),e.remove()},1)}};var y=function(t){this.name="formDataUploadModule",this.element=t.wrapper,this.upload=t,this.element.bind("t:select",e.proxy(this.onSelect,this)).bind("t:cancel",e.proxy(this.onCancel,this)).bind("t:remove",e.proxy(this.onRemove,this)).bind("t:retry",e.proxy(this.onRetry,this)).bind("t:saveSelected",e.proxy(this.onSaveSelected,this)).bind("t:abort",e.proxy(this.onAbort,this))};y.prototype={onSelect:function(t,n){var r=this.upload,i=this,s=e(t.target),o=n?E(n):this.inputFiles(s),u=this.prepareUpload(s,o);e.each(u,function(){r.options.async.autoUpload?i.performUpload(this):(r._supportsRemove()&&r._fileAction(this,d),r._showUploadButton())})},prepareUpload:function(t,n){var r=this.enqueueFiles(n);return t.is("input")&&(e.each(r,function(){e(this).data("relatedInput",t)}),t.data("relatedFileEntries",r),this.upload._addInput(t.clone().val(""))),r},enqueueFiles:function(t){var n=this.upload,r,i,s=t.length,o,u,a=[];if(n.options.async.batch===!0)r=e.map(t,function(e){return e.name}).join(", "),u=n._enqueueFile(r,{fileNames:t}),u.data("files",t),a.push(u);else for(i=0;i<s;i++)o=t[i],r=o.name,u=n._enqueueFile(r,{fileNames:[o]}),u.data("files",[o]),a.push(u);return a},inputFiles:function(e){return w(e)},performUpload:function(t){var n=this.upload,r=this.createFormData(t.data("files")),i={files:t.data("fileNames")};if(!n.trigger(a,i)){n._fileAction(t,h),n._hideUploadButton(),i.data=e.extend({},i.data,M());for(var s in i.data)r.append(s,i.data[s]);n._fileState(t,"uploading"),this.postFormData(this.upload.options.async.saveUrl,r,t)}else this.removeFileEntry(t)},onSaveSelected:function(t){var n=this;e(".k-file",this.element).each(function(){var t=e(this),r=A(t);r||n.performUpload(t)})},onCancel:function(e){var t=O(e);this.stopUploadRequest(t),this.removeFileEntry(t)},onRetry:function(e){var t=O(e);this.performUpload(t)},onRemove:function(e,t){var n=O(e);n.children(".k-icon").is(".k-success")?N(n,this.upload,t):this.removeFileEntry(n)},postFormData:function(e,t,n){var r=new XMLHttpRequest,i=this;n.data("request",r),r.addEventListener("load",function(e){i.onRequestSuccess.call(i,e,n)},!1),r.addEventListener(l,function(e){i.onRequestError.call(i,e,n)},!1),r.upload.addEventListener("progress",function(e){i.onRequestProgress.call(i,e,n)},!1),r.open("POST",e),r.withCredentials="true",r.send(t)},createFormData:function(e){var t=new FormData,n=this.upload,r,i=e.length;for(r=0;r<i;r++)t.append(n.options.async.saveField||n.name,e[r].rawFile);return t},onRequestSuccess:function(e,t){function i(){t.trigger("t:upload-error",[n])}var n=e.target,r=this;n.status>=200&&n.status<=299?C(n.responseText,function(e){t.trigger("t:progress",[100]),t.trigger("t:upload-success",[e,n]),r.cleanupFileEntry(t)},i):i()},onRequestError:function(e,t){var n=e.target;t.trigger("t:upload-error",[n])},cleanupFileEntry:function(t){var n=t.data("relatedInput"),r=!0;n&&(e.each(n.data("relatedFileEntries")||[],function(){this.parent().length>0&&this[0]!=t[0]&&(r=r&&this.children(".k-icon").is(".k-success"))}),r&&n.remove())},removeFileEntry:function(e){this.cleanupFileEntry(e),this.upload._removeFileEntry(e)},onRequestProgress:function(e,t){var n=Math.round(e.loaded*100/e.total);t.trigger("t:progress",[n])},stopUploadRequest:function(e){e.data("request").abort()}},n.ui.plugin(v)})(jQuery);