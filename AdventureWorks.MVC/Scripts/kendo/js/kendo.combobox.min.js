/*
* Kendo UI Beta v2012.3.1024 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

;(function(e,t){var n=window.kendo,r=n.ui,i=r.List,s=r.Select,o=n.support,u=o.placeholder,a=s.removeFiltersForField,f=n.keys,l=".kendoComboBox",c=(o.touch?"touchend":"click")+l,h="disabled",p="change",d="k-state-default",v="k-state-disabled",m="k-state-focused",g="mousedown"+l,y="select",b="aria-disabled",w="k-state-selected",E="filter",S="accept",x="rebind",T="mouseenter"+l+" mouseleave"+l,N=null,C=e.proxy,k=s.extend({init:function(t,r){var i=this,o,u;i.ns=l,r=e.isArray(r)?{dataSource:r}:r,s.fn.init.call(i,t,r),i._focusHandler=function(){i.input.focus()},r=i.options,t=i.element.on("focus"+l,i._focusHandler),r.placeholder=r.placeholder||t.attr("placeholder"),i._reset(),i._wrapper(),i._input(),i._popup(),i._accessors(),i._dataSource(),i._enable(),i._cascade(),o=i._inputWrapper,i.input.on("keydown"+l,C(i._keydown,i)).on("focus"+l,function(){o.addClass(m),i._placeholder(!1)}).on("blur"+l,function(){o.removeClass(m),clearTimeout(i._typing),i.options.text!==i.input.val()&&i.text(i.text()),i._placeholder(),i._blur(),t.blur()}).attr({role:"combobox","aria-expanded":!1}),i._aria(),i._oldIndex=i.selectedIndex=-1,i._old=i.value(),r.autoBind?i._filterSource():(u=r.text,!u&&t.is(y)&&(u=t.children(":selected").text()),u&&i.input.val(u)),u||i._placeholder(),n.notify(i)},options:{name:"ComboBox",enable:!0,index:-1,autoBind:!0,delay:200,dataTextField:"",dataValueField:"",minLength:0,height:200,highlightFirst:!0,template:"",filter:"none",placeholder:"",suggest:!1,ignoreCase:!0,animation:{}},events:["open","close",p,"select","dataBinding","dataBound"],setOptions:function(e){s.fn.setOptions.call(this,e),this._template(),this._accessors(),this._aria()},current:function(e){var n=this,r=n._current;if(e===t)return r;r&&r.removeClass(w),s.fn.current.call(n,e)},destroy:function(){var e=this;e.input.off(l),e.element.off(l),e._inputWrapper.off(l),s.fn.destroy.call(e)},enable:function(e){var t=this,n=t.input.add(t.element),r=t._inputWrapper.off(T),i=t._arrow.parent().off(c+" "+g);e===!1?(r.removeClass(d).addClass(v),n.attr(h,h).attr(b,!0)):(r.removeClass(v).addClass(d).on(T,t._toggleHover),n.removeAttr(h).attr(b,!1),i.on(c,function(){t.toggle()}).on(g,function(e){e.preventDefault()}))},open:function(){var e=this,t=e.dataSource.options.serverFiltering;if(e.popup.visible())return;!e.ul[0].firstChild||e._state===S&&!t?(e._open=!0,e._state=x,e._filterSource()):(e.popup.open(),e._scroll(e._current))},refresh:function(){var r=this,i=r.ul[0],s=r.options,o=r._state,u=r._data(),a=u.length,f,l,c;r.trigger("dataBinding"),i.innerHTML=n.render(r.template,u),r._height(a),r.popup.visible()&&r.popup._position(),r.element.is(y)&&(o===x&&(f=r.value(),r._state=""),c=r._option,r._option=t,r._options(u),c&&c[0].selected&&r._custom(c.val())),a&&(s.highlightFirst&&r.current(e(i.firstChild)),s.suggest&&r.input.val()&&r._valueCalled!==t&&r.suggest(e(i.firstChild))),r._open&&(r._open=!1,l=!!a,r._typing&&r.input[0]!==document.activeElement&&(l=!1),r.toggle(l),r._typing=t),r._touchScroller&&r._touchScroller.reset(),r._makeUnselectable(),!r._valueCalled&&o!==E&&(r._selectItem(f),r._valueCalled=!1),r._hideBusy(),r.trigger("dataBound")},select:function(e){var n=this;if(e===t)return n.selectedIndex;n._select(e),n._old=n._accessor(),n._oldIndex=n.selectedIndex},search:function(e){e=typeof e=="string"?e:this.text();var t=this,n=e.length,r=t.options,i=r.ignoreCase,s=r.filter,o=r.dataTextField;clearTimeout(t._typing),n>=r.minLength&&(t._state=E,s==="none"?t._filter(e):(t._open=!0,t._filterSource({value:i?e.toLowerCase():e,field:o,operator:s,ignoreCase:i})))},suggest:function(e){var n=this,r=n.input[0],s=n.text(),o=i.caret(r),u=n._last,a;if(u==f.BACKSPACE||u==f.DELETE){n._last=t;return}e=e||"",typeof e!="string"&&(a=i.inArray(e[0],n.ul[0]),a>-1?e=n._text(n.dataSource.view()[a]):e=""),o<=0&&(o=s.toLowerCase().indexOf(e.toLowerCase())+1),e?(a=e.toLowerCase().indexOf(s.toLowerCase()),a>-1&&(s+=e.substring(a+s.length))):s=s.substring(0,o);if(s.length!==o||!e)r.value=s,i.selectText(r,o,s.length)},text:function(e){e=e===null?"":e;var n=this,r=n._text,i=n.input[0],s=n.options.ignoreCase,o=e,u;if(e===t)return i.value;u=n.dataItem();if(u&&r(u)===e)return;s&&(o=o.toLowerCase()),n._select(function(e){return e=r(e),s&&(e=(e+"").toLowerCase()),e===o}),n.selectedIndex<0&&(n._custom(e),i.value=e)},toggle:function(e){var t=this;t._toggle(e)},value:function(e){var n=this,r;if(e===t)return n._accessor();e!==null&&(e=e.toString()),n._valueCalled=!0;if(e&&n._valueOnFetch(e))return;r=n._index(e),r>-1?n.select(r):(n.current(N),n._custom(e),n.text(e),n._placeholder()),n._old=n._accessor(),n._oldIndex=n.selectedIndex},_accept:function(e){var t=this;e&&t.popup.visible()?t._focus(e):(t.text(t.text()),t._change())},_custom:function(t){var n=this,r=n.element,i=n._option;n._state===E&&(n._state=S),r.is(y)?(i||(i=n._option=e("<option/>"),r.append(i)),i.text(t),i[0].selected=!0):r.val(t)},_filter:function(e){var n=this,r=n.options,i=n.dataSource,s=r.ignoreCase,o=function(r){var i=n._text(r);if(i!==t)return i+="",i!==""&&e===""?!1:(s&&(i=i.toLowerCase()),i.indexOf(e)===0)};s&&(e=e.toLowerCase());if(!n.ul[0].firstChild){i.one(p,function(){i.data()[0]&&n.search(e)}).fetch();return}n._highlight(o)!==-1&&(r.suggest&&n._current&&n.suggest(n._current),n.open()),n._hideBusy()},_highlight:function(n){var r=this,s;return n===t||n===null?-1:(n=r._get(n),s=i.inArray(n[0],r.ul[0]),s==-1&&(r.options.highlightFirst&&!r.text()?n=e(r.ul[0].firstChild):n=N),r.current(n),s)},_input:function(){var t=this,n=t.element[0],r=n.tabIndex,i=n.accessKey,s=t.wrapper,o=".k-input",a,f,l=n.name||"";l&&(l='name="'+l+'_input" '),a=s.find(o),a[0]||(s.append('<span tabindex="-1" unselectable="on" class="k-dropdown-wrap k-state-default"><input '+l+'class="k-input" type="text" autocomplete="off"/><span tabindex="-1" unselectable="on" class="k-select"><span unselectable="on" class="k-icon k-i-arrow-s">select</span></span></span>').append(t.element),a=s.find(o)),f=a[0],f.tabIndex=r,f.style.cssText=n.style.cssText,n.maxLength>-1&&(f.maxLength=n.maxLength),a.addClass(n.className).val(n.value).css({width:"100%",height:n.style.height}).show(),u&&a.attr("placeholder",t.options.placeholder),i&&(n.accessKey="",a[0].accessKey=i),t._focused=t.input=a,t._inputWrapper=e(s[0].firstChild),t._arrow=s.find(".k-icon").attr({role:"button",tabIndex:-1}),n.id&&t._arrow.attr("aria-controls",t.ul[0].id)},_keydown:function(e){var t=this,n=e.keyCode;t._last=n,clearTimeout(t._typing),n!=f.TAB&&!t._move(e)&&t._search()},_placeholder:function(e){if(u)return;var n=this,r=n.input,i=n.options.placeholder,s;if(i){s=n.value(),e===t&&(e=!s),r.toggleClass("k-readonly",e);if(!e){if(!!s)return;i=""}r.val(i)}},_search:function(){var e=this;e._typing=setTimeout(function(){var t=e.text();e._prev!==t&&(e._prev=t,e.search(t))},e.options.delay)},_select:function(e){var n=this,r,i,s=n._data(),o=n._highlight(e);n.selectedIndex=o,o!==-1&&(n._state===E&&(n._state=S),n._current.addClass(w),s=s[o],r=n._text(s),i=n._value(s),n._prev=n.input[0].value=r,n._accessor(i!==t?i:r,o),n._placeholder(),n._optionID&&n._current.attr("aria-selected",!0))},_filterSource:function(e){var t=this,n=t.options,r=t.dataSource,i=r.filter()||{};a(i,n.dataTextField),e&&(i=i.filters||[],i.push(e)),r.filter(i)},_wrapper:function(){var e=this,t=e.element,n=t.parent();n.is("span.k-widget")||(n=t.hide().wrap("<span />").parent(),n[0].style.cssText=t[0].style.cssText),e.wrapper=n.addClass("k-widget k-combobox k-header").addClass(t[0].className).css("display","")}});r.plugin(k)})(jQuery);