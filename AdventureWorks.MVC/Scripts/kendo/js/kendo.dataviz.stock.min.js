/*
* Kendo UI Beta v2012.3.1024 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Beta license terms available at
* http://www.kendoui.com/purchase/license-agreement/kendo-ui-beta.aspx
*/

;(function(e,t){var n=window.kendo,r=n.Class,i=n.ui.Widget,s=n.deepExtend,o=Math,u=n.dataviz,a=u.ui.Chart,f=u.DateCategoryAxis,l=u.Selection,c=u.duration,h=u.lteDateIndex,p=u.toDate,d=28,v="_navigator",m=v,g=a.extend({init:function(e,t){var n=this;a.fn.init.call(n,e,t)},_applyDefaults:function(e,t){var n=this,r=n.element.width()||u.DEFAULT_WIDTH,i={axisDefaults:{categoryAxis:{field:e.dateField,majorGridLines:{visible:!1},labels:{step:2},majorTicks:{visible:!1},maxDateGroups:Math.floor(r/d)}}};t&&s(t,i),n._navigator||y.setup(e,t),a.fn._applyDefaults.call(n,e,t)},options:{name:"StockChart",axisDefaults:{categoryAxis:{type:"date",baseUnit:"fit",justified:!0},valueAxis:{narrowRange:!0}},dateField:"date",navigator:{seriesDefaults:{markers:{visible:!1},tooltip:{visible:!0,template:"#= kendo.toString(category, 'd') #"},width:1.5}},tooltip:{visible:!0}},_redraw:function(){var t=this,r=t._navigator;r||(r=t._navigator=new y(t)),r.applySelection(),a.fn._redraw.call(t),r.redraw(),n.ui.Draggable&&(t._draggable&&t._draggable.destroy(),e(t._viewElement).kendoDraggable({drag:e.proxy(t._onDrag,t),dragstart:e.proxy(t._onDragStart,t),dragend:e.proxy(t._onDragEnd,t)}),t._draggable=e(t._viewElement).data("kendoDraggable"))},_onDragStart:function(e){var t=this,n=t._plotArea.categoryAxis,r=n.options,i=t._eventCoordinates(e),s=n.options.baseUnit;if(!t._plotArea.panes[0].box.containsPoint(i)){e.preventDefault();return}var o=c(r.categories[0],u.last(r.categories),s);delete t._activePoint,t._tooltip.hide(),t._highlight.hide(),t._suppressHover=!0,t._dragState={min:r.min,max:r.max,range:o,scale:n.box.width()/o,baseUnit:s}},_onDrag:function(e){var t=this,n=e.x.startLocation-e.x.location,r=t._plotArea.panes,i=t._plotArea.categoryAxis,s=t._plotArea.namedCategoryAxes[m],a=t._dragState,f=a.baseUnit,l=o.round(n/a.scale),c=p(o.min(o.max(s.options.categories[0],u.addDuration(a.min,l,f)),u.addDuration(u.last(s.options.categories),-a.range,f))),d=p(o.min(u.addDuration(c,a.range,f),u.last(s.options.categories))),v=t._plotArea.options.categoryAxis[0];v.min=c,v.max=d,t._plotArea.redrawPane(r[0]);var g=t._selection;g.setRange(h(s.options.categories,c),h(s.options.categories,d))},_onDragEnd:function(e){this._suppressHover=!1}}),y=r.extend({init:function(e){var t=this;t.chart=e,t.options=e.options.navigator},redraw:function(){var t=this,n=t.chart,r=t.mainAxis(),i=r.options.categories,s=t.options.select||{},o=0,u=i.length-1,a=o,f=u;if(i.length>0){s.from&&(a=h(i,p(s.from))),s.to&&(f=h(i,p(s.to)));var c=n._selection=new l(n.element,r,{start:a,end:f,min:o,max:u,snap:!0,select:e.proxy(t.onSelect,t)})}},applySelection:function(){var e=this,t=e.options.select||{},n=e.chart,r=n.options.categoryAxis,i,s;for(i=0;i<r.length;i++)s=r[i],s.pane!==v&&(s.min=t.from,s.max=t.to)},onSelect:function(e){var t=this,n=t.mainAxis(),r=n.options.categories,i=t.options.select,s=t.chart,o=s._plotArea,u=o.panes.slice(0,-1),a;i.from=r[e.start],i.to=r[e.end],t.applySelection();for(a=0;a<u.length;a++)s._plotArea.redrawPane(u[a])},mainAxis:function(){return this.chart._plotArea.namedCategoryAxes[m]}});y.setup=function(e,t){e=e||{},t=t||{};var n=s({},e.navigator,t.navigator),r=e.panes=[].concat(e.panes);r.push(s({},n.pane,{name:v})),y.attachAxes(e),y.attachSeries(e,n,t)},y.attachAxes=function(e){var t=e.dateField,n,r;n=e.categoryAxis=[].concat(e.categoryAxis),r=e.valueAxis=[].concat(e.valueAxis);var i={type:"date",field:t,pane:v,roundToBaseUnit:!1,justified:!0,tooltip:{visible:!1},labels:{step:1}};n.push(s({},i,{name:m,baseUnit:"fit",maxDateGroups:200,baseUnitStep:"auto",labels:{visible:!1},majorTicks:{visible:!1}}),s({},i,{name:m+"_labels",maxDateGroups:20,baseUnitStep:"auto",autoBaseUnitSteps:{minutes:[],hours:[1],days:[1],weeks:[],months:[1],years:[1]},majorTicks:{visible:!0}}),s({},i,{name:m+"_ticks",maxDateGroups:200,autoBaseUnitSteps:{minutes:[1],hours:[1],days:[1],weeks:[],months:[1],years:[1]},majorTicks:{visible:!0,width:.5},labels:{visible:!1,mirror:!0}})),r.push({name:m,pane:v,majorGridLines:{visible:!1},visible:!1})},y.attachSeries=function(e,t,n){var r=e.series=e.series||[],i=[].concat(t.series),o=n.seriesColors,u=t.seriesDefaults,a;for(a=0;a<i.length;a++)r.push(s({color:o[a%o.length]},u,i[a],{axis:m,categoryAxis:m}))},u.ui.plugin(g),s(u,{})})(jQuery);